<!DOCTYPE html>
<HTML>
<HEAD>
<META name=description content="edbrowse documentation, a text based editor, browser, and mail client.">
<meta name=keywords content="
text based, command line, interactive,
editor, browser, mail client,
portable, C,
javascript,
secure, ssl,
blind, script, accessible">
<TITLE> edbrowse documentation </TITLE>
<LINK REL="SHORTCUT ICON" href="pc.ico">
        <style type="text/css">
body { background: white; color: black; font-family: Arial,Helvetica,sans-serif; font-size: 1.0em; }
a:link { color: red; }
a:active { color: green; }
a:visited { color: red; }
a:hover { color: green; }
h2 { text-align: center; color: navy; font-size: 1.6em; }
h3 { text-align: center; color: darkslateblue; font-size: 1.0em; }
h4 { text-align: center; color: royalblue; font-size: 1.0em; }
hr { border-style: solid; color: black; height: 2px; }
p.cen { text-align: center; }
</style>
</HEAD>

<BODY>

<H2> edbrowse Documentation, a User's Guide </H2>

<H2> Chapter 0, <A NAME=top> Contents </A> </H2>

<H4> Chapter 1, Preface </H4>

<UL>
<LI><A HREF=#maint> Maintainer </A>
<LI><A HREF=#auth> Author </A>
<LI><A HREF=#copy> Copyright Notice </A>
<LI><A HREF=#disclaim> Disclaimer </A>
<LI><A HREF=#ack> Acknowledgements </A>
<LI><A HREF=#over> Overview </A>
<LI><A HREF=#lang> Other Languages </A>
</UL>

<H4> Chapter 2, Quick Reference Guide </H4>

<UL>
<LI><A HREF=#guide> Quick Reference Guide </A>
<LI><A HREF=#tips> Tips for Avoiding Line Numbers </A>
<LI><A HREF=#mlist> Mailing List </A>
<LI><A HREF=#wiki> Edbrowse Wiki </A>
</UL>

<H4> Chapter 3, The Editor </H4>

<UL>
<LI><A HREF=#dev> Important Deviations From /bin/ed </A>
<LI><A HREF=#brace> Balancing Braces </A>
<LI><A HREF=#cx> Context Switch </A>
<LI><A HREF=#usage> Usage </A>
<LI><A HREF=#bin> Binary Characters </A>
<LI><A HREF=#bfile> Binary Files </A>
<LI><A HREF=#dir> Directory Scan, File Manager </A>
<LI><A HREF=#case> Upper/Lower Case </A>
<LI><A HREF=#bl> Break Line </A>
<LI><A HREF=#race> Race Conditions </A>
</UL>

<H4> Chapter 4, Web Browser </H4>

<UL>
<LI><A HREF=#url> Accessing A URL </A>
<LI><A HREF=#browse> Browse Mode </A>
<LI><A HREF=#math> Technical, Math </A>
<LI><A HREF=#title> Title, Description, Keywords </A>
<LI><A HREF=#rf> The Refresh Command </A>
<LI><A HREF=#hlink> Hyperlinks </A>
<LI><A HREF=#ilink> Internal Links </A>
<LI><A HREF=#back> The Back Key </A>
<LI><A HREF=#move> The M Command </A>
<LI><A HREF=#music> Background Music </A>
<LI><A HREF=#heading> Headings </A>
<LI><A HREF=#input> Input Fields </A>
<LI><A HREF=#entry> Data Entry </A>
<LI><A HREF=#textarea> Text Areas </A>
<LI><A HREF=#button> Push The Button </A>
<LI><A HREF=#hover> Hover Text </A>
<LI><A HREF=#colors> Colors on the Page </A>
<LI><A HREF=#addr> Web And Email Addresses </A>
<LI><A HREF=#cook> Cookies </A>
<LI><A HREF=#ssl> Secure Connections </A>
<LI><A HREF=#ftp> FTP Retrievals </A>
<LI><A HREF=#gopher> Gopher Support </A>
<LI><A HREF=#proxy> Proxy Servers </A>
<LI><A HREF=#frame> Frames </A>
</UL>

<H4> Chapter 5, Javascript </H4>

<UL>
<LI><A HREF=#js> Introduction to Javascript </A>
<LI><A HREF=#valid> Validating and Modifying Forms </A>
<LI><A HREF=#popup> Popups and Popunders </A>
<LI><A HREF=#onc> Onchange and Undo </A>
<LI><A HREF=#jex> Javascript Debugger </A>
</UL>

<H4> Chapter 6, Edbrowse Scripts and the Configuration File </H4>

<UL>
<LI><A HREF=#cfg> The Config File </A>
<LI><A HREF=#keyval> Keyword = Value </A>
<LI><A HREF=#agent> User Agent </A>
<LI><A HREF=#script> Edbrowse Functions </A>
<LI><A HREF=#init> The Init Script </A>
<LI><A HREF=#ma> Mail Accounts </A>
<LI><A HREF=#mt> Plugin Descriptors </A>
<LI><A HREF=#sampcfg> A Sample Config File </A>
</UL>

<H4> Chapter 7, Mail Client </H4>

<UL>
<LI><A HREF=#sm> Send Mail </A>
<LI><A HREF=#smc> Send Mail Client </A>
<LI><A HREF=#retrmail> Retrieving Mail </A>
<LI><A HREF=#imr> Interactive Mail Reader </A>
<LI><A HREF=#mailfmt> Formatted Mail </A>
<LI><A HREF=#filter> Mail Filtering </A>
<LI><A HREF=#reply> Mail Reply </A>
<LI><A HREF=#imap> Imap Client </A>
</UL>

<H4> Chapter 8, Database Access </H4>

<UL>
<LI><A HREF=#sqlb> Building edbrowse with Database Access </A>
<LI><A HREF=#rtb> Reading Tables </A>
<LI><A HREF=#dsource> Data Source </A>
<LI><A HREF=#insupd> Insert, Update, Delete </A>
<LI><A HREF=#td> Table Descriptors </A>
<LI><A HREF=#gosql> Go SQL </A>
</UL>

<HR>
<H2> Chapter 1, Preface </H2>

<H3> <A NAME="maint"> Maintainer </A> </H3>

<P>
The edbrowse home page is <A href=http://edbrowse.org>edbrowse.org</A>.
<A HREF="mailto:maintainers@edbrowse.org">
Chris Brannon</A>
is the current project maintainer and webmaster.

<H3> <A NAME=auth> Author </A> </H3>

<P>
<A HREF=mailto:eklhad@gmail.com>
Karl Dahlke</A>
wrote the first version of edbrowse in perl, in 2001,
and he is still the principal developer of the project.
<!--
Please see the
<A href=http://en.wikipedia.org/wiki/edbrowse>
wikipedia article</A> for a history of edbrowse and an overview of its features.
-->

<H3> <A NAME=copy> Copyright Notice </A> </H3>

<P>
This program is copyright &copy; Karl Dahlke (and other authors and contributors), 2001-2018.
It is made available by the authors under the terms of the GNU General Public License (GPL),
as articulated by the Free Software Foundation.
It may be used for any purpose, and redistributed, provided this copyright notice is included.

<H3> <A NAME=disclaim> Disclaimer </A> </H3>

<P>
Edbrowse is provided as-is,
with no implied warranty of fitness for any particular purpose.
It might trash your precious files.
It might send bad data across the Internet,
causing you to buy a $37,000 elephant instead of
$37 worth of printer supplies.
It may delete all the rows in your mysql customer table.
This is a spare-time project written by a couple of volunteers,
that (understandably) cannot attain the quality and rigor of corporate or government software.
By using this program, you agree to use it as-is.

<H3> <A NAME=ack> Acknowledgements </A> </H3>

<P>
<A HREF=mailto:chris@the-brannons.com>
Chris Brannon</A> wrote or modified at least 20% of the code,
and provided valuable ideas for the overall design.
<A href=mailto:arthompson1990@gmail.com>
Adam Thompson</A>
converted the javascript interface from C to C++, as required by Mozilla JS versions 2,
and he continues to direct the project's overall architecture.
<A href=mailto:kevin@carhart.net>
Kevin Carhart</A>
deciphered the mysteries of jquery,
and upgraded the DOM to support it.
<A HREF=mailto:obrien654j@gmail.com>
Jeremy O'Brien</A> ported the software to Mac OS X,
and
<A href=mailto:ubuntu@geoffair.info>
Geoff McLane</A>
provided the Windows port, and a general cmake configure and build system.
Several people translated the output and error messages into other languages,
and they are given due credit in the Languages section below.

<H3> <A NAME=over> Overview </A> </H3>

<P>
This program is, at first glance, a reimplementation of /bin/ed.
In fact you might issue a few ed commands and not realize that you are
actually running this program.
But as you proceed
you will eventually discover some discrepancies,
areas where edbrowse differs from ed.
These are discussed below.

<P>
Reinventing ed seems like a complete waste of time,
until you realize that this program also acts as a browser -
a browser embedded inside ed.
You can edit a URL as easily as a local file,
and activate browse mode to render the html tags
in a manner that is appropriate for a command-response program such as this.
In other words, we discard most of the formatting information
and retain the links and fill-out forms.
This allows blind  users to access the Internet
through an application that is compatible with the linear nature of speech or braille.

<P>
Edbrowse presents the following features:

<UL>
<LI><P> Edbrowse can edit multiple files or browse multiple websites simultaneously, and transfer blocks of text between them in a manner similar to cut&amp;paste.
For instance, <code>edbrowse *.c</code> accesses all the C sourcefiles in the current directory.
<LI><P> The regular expressions of ed have been replaced with Perl Compatible Regular Expressions, which have more power and flexibility. This simplifies the task of finding or modifying text in a large document. You can, for instance, replace each instance of the word foo, not foot or food, but foo by itself, in upper or lower case, with the word bar, as long as foo is not followed by an exclamation point or a question mark. The change in regular expressions means edbrowse is not 100% backward compatible with ed, though it is close.
<LI><P> Edbrowse can fetch a web page from the internet as easily as it opens a file on the current computer, using http, https, ftp, or gopher.
Once the page is fetched into the active buffer, it can be browsed or rendered as text, using the b command.
This supplements the other one-letter commands which were already part of ed.
Once the page is browsed, the user can go to hyperlinks, or fill out and submit forms.
<LI><P> The -fm option turns edbrowse into an interactive email client.
It fetches mail from one or more pop3 accounts and presents these emails to the user one at a time, where they can be read, deleted, or saved to a file for future reference.
Filters can automatically save certain emails to certain files, based on subject, sender, or destination email address.
Other options cause edbrowse to send mail using smtp.
imap is also supported.
<LI><P> In database mode, edbrowse can access selected rows and columns of an sql table through odbc.
The insert, substitute, and delete commands of edbrowse now correspond to the insert, update, and delete operations of a database respectively.
This feature is well tested on some databases, and completely untested on others.
Since text editing has consequences outside the context of the current buffer, there is no undo command.
When a row is deleted, it is gone, without any chance of retrieval.
Fortunately, referential integrity often prevents these unintended deletions.
<LI><P> When editing a directory, each line of text corresponds to a file.
Again, the substitute command renames a file, while the delete command removes a file, or moves it to your trash can, depending on your edbrowse configuration.
There is no undo operation, thus moving files to the trash can is safer. However, this does not free up any disk space.
<LI><P> The edbrowse configuration file can contain functions, similar to the .bashrc file in Linux.
These functions can invoke other edbrowse commands, along with branching and loops based on the success of these commands.
This simple example changes every x to y.
If any changes were made, the file is written back to disk.
The * in the if statement is true if the previous command was successful.
</UL>

<PRE><font size=3 face=Arial,Helvetica,sans-serif><code>function+xy {
        ,s/x/y/g
        if(*) {
                w
        }
}
</code></font></PRE>

<P>
If edbrowse is not included in your distribution, there is a perl version, with fewer features,
that you can bring up right away on any computer:
Linux, Unix, Mac, Windows, etc.
Give edbrowse.pl a try, and if you like it then you can git the package and build it from source
to realize the full-featured C version.

<P>
If you are a Linux user, and your distribution doesn't package edbrowse,
you can use the aforementioned perl version of course,
but you can also run the full-featured C version
without going through the hassle of building it yourself.
Statically-linked executables for 32 bit and 64 bit architectures
are maintained on the
<A href=http://edbrowse.org>
edbrowse home page</A>.

<P>
This documentation assumes you are familiar with ed.
In fact it helps if you are fluent in ed.
Experience with internet browsers and the associated terminology is also helpful.

<H3> <A NAME=lang> Other Languages </A> </H3>

<P>
First, a few words about character sets (charsets).
English is easily contained within a byte stream, one letter per byte.
In fact, each letter fits in 7 bits; the eighth bit is not needed, and is set to 0.
This system is called ascii, and is English specific.

<P>
<A HREF=http://en.wikipedia.org/wiki/Indo-European_languages>
Indo-european languages</A>
bring in more characters,
such as &ntilde; (Spanish), &egrave; (French),
and &ouml; (German).
These can still fit within single bytes,
by setting the eighth bit to 1, according to the
<A HREF=http://en.wikipedia.org/wiki/ISO_8859>
ISO8859-1</A> standard.
Still other languages, such as Czech and Hungarian, fit within the
<A HREF=http://en.wikipedia.org/wiki/ISO/IEC_8859-2>
iso8859-2</A> standard,
which assigns different characters to the bytes above 127.
And there is iso8859-3, and so on.
Select your code page, and all the letters of your language still fit within one byte.
This is the iso8859 standard, and it is backward compatible with ascii.
In other words, z is 122 in ascii and in every iso8859-x code page,
but the higher numbers, above 127, could represent different letters in different languages.

<P>
This worked well for a while,
but what if you want to write one paragraph in French and one in Czech?
You either switch from iso8859-1 to iso8859-2 in mid stream,
or we come up with a new standard that represents all letters in all languages simultaneously.
This charset, which obviously will not fit into a single byte,
is known as
<A HREF=http://en.wikipedia.org/wiki/Utf8>
utf8</A>,
and it has become the new standard across the computer industry.
Software does not have to select an iso8859 page and map numbers to letters in a manner that depends on the country you live in.
Instead, &ntilde; is represented by two bytes, not one.
This is transparent to you; you see the same letter on the screen,
and you hear the same sounds if your screen reader passes these letters to a speech synthesizer.
A quick way to tell which system you are on is to echo $LANG.
If it ends in utf8 or utf-8,
and it probably does,
then your console is using utf8, and it expects two-byte sequences.
Your files probably contain these underlying sequences.
Older pre-utf8 systems store each character in a single byte, with an iso8859 codepage doing the translation.

<P>
There's much more to say about charsets; this is merely a brief introduction.
I need not go further, because edbrowse only supports iso8859-1 &#8660; utf8 at this time.
Other iso8859 pages are not supported, and even iso8859-1 may drop off in the future,
since utf8 is nearly universal.

<P>
The output and error messages,
such as "search string not found",
have been internationalized.
Set the environment variable LANG to interact with edbrowse in your home language.
Supported languages are shown below.
If you can translate edbrowse into additional languages,
please contact the developers.

<P>
English: LANG=en (this is the default)

<P>
French: LANG=fr by
Erwin Bliesenick
including <A HREF=usersguide_fr.html>documentation</A>

<P>
Brazilian Portuguese: LANG=pt_br by
Cleverson Casarin Uliana

<P>
Polish: LANG=pl_pl by Wojciech Gac

<P>
German: LANG=de by Sebastian Humenda

<P>
Italian: LANG=it by Enrico Mioso

<P>
When an output or error message is displayed,
accented letters are printed using single bytes, vectoring through an iso8859 page,
unless the string utf8 or utf-8 appears in $LANG,
whence the nonascii characters are generated using utf8.
Similarly, the contents of a buffer, be it a local document or an internet website,
are displayed as single bytes or multi-byte sequences,
according to $LANG.
Bear in mind, utf8 has become the standard, and edbrowse may not display text or error messages through iso8859 pages for long.
In other words, iso8859 is deprecated.

<P>
If an older file is read into edbrowse,
i.e. read into an empty buffer,
and that file is in iso8859, while your computer is set to run in utf8,
then that file is converted on the fly before you ever see it.
Thus it will look normal to you.
Use the iu command to disable this feature.

<P>
When you write data out to the same file,
e.g. if you have made some corrections or additions,
edbrowse converts it back to its original single-byte iso8859 charset,
and restores dos newline crlf sequences if the file was originally a dos text file.
Thus you can send the edited file back to your friend,
and it will be in his charset as he expects.
However, if you write the data, or any portion of that data, into a new file,
it is left in the charset that is used by your computer.

<P>
These conversions should never take place on zip files, or executable files,
or other forms of binary data.
If you see the words
"converting to iso8859"
or "converting to utf8",
and the file is something other than international text,
we have a problem.
Don't try to run the converted executable; it won't work.

<P>
If your world is utf8, the search function can lead to some confusion.
Consider the Spanish word ni&ntilde;o, for a boy child.
If you search for ni.o, you may not find this line of text.
The dot stands for one character, and should match &ntilde;, but this accented letter takes up two bytes.
Ironically, you have to search for ni..o, and you will find what you are looking for.
Needless to say, this is very confusing.

<P>
Search and substitute is performed by the pcre library,
and fortunately, the latest version supports utf8.
Edbrowse passes pcre an option that tells it to treat certain two-byte sequences as single letters,
and thus it behaves the way you want it to.
Searching for ni.o works again.
If you want to disable utf8 search and substitute temporarily, use the su8 command.

<P>
Some websites offer their contents in multiple languages.
For example, twitter.com has an English version,
a French version, and so forth.
It is possible to select the language when requesting the page.
Edbrowse supports this via the localizeweb keyword in its configuration file.
For instance, the following entry in .ebrc indicates that you want the
French version, when it is available.

<P>
localizeweb = fr

<P>
If not specified, edbrowse defers to the environment variable $LANG, which is set on almost every system.
Thus you rarely need to set localizeweb in your config file.
If LANG is not set, the default is English.
Edbrowse always sends a language designator to the web servers, because some websites, such as amazon.com, will not run properly without it.
If you do set localizeweb yourself, be sure to set it to language code hyphen territory code.

<hr>
<H2> Chapter 2, Quick Reference Guide </H2>

<H3> <A NAME=guide> Quick Reference Guide </A> </H3>

<P>
Here are the ed and edbrowse commands, all in one place.
This is a quick reference guide.
Most of these commands will not make sense until you read the rest of the documentation.
<!-- qrg start -->
Commands that are designated (toggle), such as js to turn javascript on and off, also admit a + or - suffix to explicitly enable or disable the feature.
Thus js toggles javascript, js+ enables javascript, and js- disables javascript.
The + and - variants are not listed.
Toggle prints the state of the feature, on or off, if help messages are enabled or if the debug level is at least 1.
Seting or clearing a mode only prints the message if help messages are on.

<P>
Leave the Program
<P>
q : quit the current session
<br>qt : quit the program completely, whether you've written your files or not
<br>bw : buffer written; you can quit at any time
<br>!command : shell escape
<br>! : interactive shell
<br>cd : change directory
<br>config : reread the config file
<P>
Input
<P>
rl : use readline() on input (toggle)
<P>
Display Lines in the Buffer
<P>
p : print the current line
<br>4,7p : print lines 4 through 7
<br>+3p : advance 3 lines and print
<br>+3 : same as +3p, print is default command
<br>- : previous line
<br>--- : back up three lines
<br>'a,'bp : print a range of lines marked with labels a and b
<br>kb : mark the current line as b
<br>l : list the current line, showing invisible chars and end markers
<br>endm : show end markers ^$ on listed lines (toggle)
<br>lna : expand all nonascii chars into hex when a line is listed (toggle)
<br>n : print the current line with its line number
<br>ll 1000 : line length 1000, show the first 1000 chars of each line
<br> ll : print the current line length
<br>z22 : print the next 22 lines
<br>z : print another 22 lines
<br>= : print the number of lines in the file
<br>.= : print the current line number
<br>B : find the line with the balancing brace
<br>B[ : find the line with the balancing bracket
<br>B( : find the line with the balancing parenthesis
<P>
Help Messages
<P>
h : help, explain the last question mark
<br>H : show all error messages (toggle)
<br>help : put this reference guide in an edbrowse buffer for review
<P>
Search and Substitute
<P>
s/x/y/ : replace x with y on the current line
<br>s/x/y : replace x with y and print the result
<br>s//y/ : use the last substitution string, in this case x
<br>s/x/%/ : use the last replacement string
<br>s : repeat the previous substitute command
<br>s/x/y/2 : replace the second instance of x with y on the current line
<br>4,7s/x/y/g : replace all instances of x with y on lines 4 through 7
<br>s/a\(.\)c/a$1$1c/ : duplicate the letter between a and c
<br>s, : replace comma space with newline, break line in two
<br>s. : replace period space with newline, break line in two
<br>s?2 : break line at the second question mark
<br>bl : break very long line into sentences and phrases
<br>fll 80 : format line length 80, cut lines to 80 chars, perhaps to fit the terminal
<br>fll 80+ : cut lines to 80 chars but allow some overflow so the next line isn't just one or two words
<br>fll : print the format line length
<br>/x/ : look for the line containing x
<br>/x : same as /x/
<br>/x/i : look for the line containing x or X
<br>?x? : look backwards for x
<br>ci : searches and substitutions are case insensitive (toggle)
<br>sg : substitution strings are global across sessions (toggle)
<br>su8 : search and substitute uses utf8 character sequences (toggle)
<br>sw : search with wrap (toggle)
<br>g/x/ p : print every line that has an x
<br>v/x/ p : print every line that does not have an x
<br>v/x/i l : list every line that does not have x or X
<br>lc : convert line to lower case
<br>mc : convert line to mixed case
<br>uc : convert line to upper case
<br>s/foo/uc : convert foo to FOO on the current line
<br>s/\bfoo\b/mc/g : convert foo to Foo, but not foobar
<br>,s/$/ %line/ : put the line number at the end of each line
<P>
Files and Sessions
<P>
f : print the name of the current file
<br>f foo : set the file name to foo
<br>f/ : retain only the lass component of the filename
<br>e : print the number of the current session
<br>e3 : move to session 3
<br>e foo : edit the file named foo
<br>r foo : read the contents of foo into the current buffer
<br>w foo : write the current buffer to foo
<br>w+ foo : append to foo
<br>w/ : write to the lass component of the filename
<br>e ~/projects/edbrowse/src/buf*.c : expand wildcards if exactly one match
<br>e $EBSRC/buf*.c : variable expansion
<br>bflist : buffer list, all edbrowse sessions and their file names
<br>bd : binary detection on files (toggle)
<br>iu : automatically convert between iso8859 and utf8 (toggle)
<P>
Text Editing, much like ed
<P>
u : undo the last command
<br>d : delete the current line
<br>1,$d : delete all the lines, 1 through eof
<br>D : delete the current line and print the next line
<br>i : insert text before the current line, end with a period
<br>c : change the current line, enter a new block of text, end with period
<br>a : add text after the current line, end with a period
<br>a+ : include the line you just typed in, when you thought you were in append mode
<br>4,7m11 : move lines 4 through 7 to line 11
<br>4,7t11 : copy lines 4 through 7 to line 11
<br>3,4j : join lines 3 and 4 together
<br>3,4J : join lines 3 and 4 together with a space between
<P>
Directory Scan
<P>
dr : directory is readonly
<br>dw : directory is writable, and d moves files to your trash bin
<br>dx : directory is writable, and d deletes files
<br>hf : show hidden files in directory listing (toggle)
<br>lsl : list length of the file on the current line, directory mode only
<br>lss : list the approximate size of the file, in kilobytes, megabytes, etc
<br>lst : list the mod time of the file
<br>lsp : list owner group permissions
<br>lsi : list the inode
<br>lsk : list the number of hard links
<br>lsm : list major and minor number
<br>lsy : list path for a symbolic link
<br>lsX : verify directory mode, primarily for scripting
<br>ls : same as lsst
<br>ls=lt : display length and time of all files in subsequent directory scans
<br>ls= : just list the files in a directory scan
<br>sort=a : sort files alphabetically
<br>sort=t : sort files by mod time
<br>sort=s : sort files by size
<br>sort+a : same as sort=a
<br>sort-a : reverse alphabetical
<br>sort-t : reverse mod time
<br>sort-s : reverse size
<br>rf : refresh directory scan, useful if you have changed ls or sort parameters
<br>M : move this directory to an empty session and back up
<br> d : delete the file or move it to your trash can; theree is no undo
<br>g/\.o$/d : delete all the .o files
<br>.m3 : move this file to the directory in session 3; there is no undo
<br>.t3 : copy this file to the directory in session 3; there is no undo
<P>
Browse an html file or a web page
<P>
b : browse the current file, either html, or email, or rendered by plugin
<br>b foo.html : edit the file foo.html and browse it
<br>b url : fetch url from the internet and browse it
<br>nostack b url : don't push a new window, replace the current window using the new url
<br>ub : unbrowse a file
<br>ft : show the title of the current web page (file title)
<br>fd : show the description of the current web page
<br>fk : show the keywords of the current web page
<br>fu : print the file's underlying URL
<br>rf : refresh the web page or directory listing
<br>et : edit this web page as pure text
<br>hr : http redirection (toggle)
<br>vs : verify ssl connections (toggle)
<br>sr : send referrer (toggle)
<br>ua3 : pretend to be the third user agent in your config file
<br>can : (curl auth negotiate) toggle SPNEGO type authentication, required for kerberos (krb5/gss)
<P>
FTP or HTTP Downloads
<P>
pdd : progress of download indicated by dots
<br>pdc : progress of download indicated by megabyte count
<br>pdq : progress of download quiet, no indicator
<br>ftpa : ftp active mode (toggle)
<br>bg : download files in background (toggle)
<br>bglist : list background downloads, complete or in progress
<br>jsbg : download javascript files in background (toggle)
<P>
Interact with a Web Page
<P>
g : go to the link on the current line
<br>g- : go to the link, but don't browse, or render, or play
<br>g2 : go to the second link on the current line
<br>g$ : go to the last link on the current line
<br>g? : print the url for the link on the current line
<br>g2? : print the url for the second link
<br>g$? : print the url for the last link
<br>exp : expand a frame
<br>,exp : expand all frames
<br>ctr : contract a frame
<br>^ : the back key, go back to the web page you were looking at before
<br>&amp; : internal link back key, go back to line before following internal link
<br>i=xyz : set the input field on the current line to xyz
<br>i2=xyz : set the second input field on the current line to xyz
<br>i2* : push the second button on the current line, usually submit or reset
<br>i$* : push the last button on the current line
<br>i3? : describe the third input field on the current line
<br>ipass2 : prompt for the content of the second input field, disabling echo
<br>ib : allocate an input buffer for this textarea
<br>M4 : move this web page to session 4 and back up to the previous page
<br>M : move this web page to an empty session and back up
<br>js : allow javascript (toggle)
<br>rr : rerender the screen, to reflect asynchronous javascript changes
<br>rr 75 : rerender the screen automatically every 75 seconds
<br>showall : show all hover and invisible text (toggle)
<br>colors : show the colors on the page
<P>
Mail Client
<P>
sm : send mail [account number]
<br>re : reply to a mail message
<br>rea : reply to all
<P>
Plugins
<P>
pb : play buffer (typically audio)
<br>pb.mp3 : play the current buffer as an mp3 file
<br>pg : plugins active (toggle)
<P>
Database Access
<P>
ds=source,login,password : set the data source
<br>sht : show tables
<br>shc : show columns (and primary key) for the current table
<br>shf : show foreign keys for the current table
<br>fbc : fetch blob columns (toggle)
<P>
Edbrowse Functions
<P>
&lt;foo arg1 arg2 &#8230; : invoke the function foo, defined in your .ebrc file
<br>X : silently make this the current line, often used in scripts
<P>
Debug
<P>
db3 : set debug level, 0 through 9
<br>db&gt;/tmp/edbrowse.out : redirect debugging output to a file
<br>demin : deminimize javascript (toggle)
<br>timers : disable javascript timers (toggle)
<br>dbcn : enable cloneNode debugging (toggle)
<br>dbev : enable event debugging (toggle)
<br>dberr : enable js error debugging (toggle)
<br>dbcss : enable css debugging (toggle)
<br>trace : inject trace points into the javascript (toggle)
<br>jdb : javascript debugger, bye to exit
<br>ok(o) : list all the members of an object, some may not be enumerable
<br>showscripts() : show scripts anywhere in the tree
<br>searchscripts(string) : look for a string in the scripts
<br>snapshot() : snapshot the javascript and css files for local debugging
<br>aloop(array, string_on[i]) : execute string on each member of the array
<br>uptrace(node) : climb up the tree from a given node
<br>dumptree(node) : show the tree below a given node
<br>bp@(label) : inject this code into a js file for a simple breakpoint
<br>step$stack() : show stack, usually from within a breakpoint
<br>step$l = 0|1|2 : set the trace level for each step
<br>step$go = label : set step$l to 2 at this point, breaking at each step thereafter
<br>step$exp = expression : set step$l to 2 when expression is true, breaking at each step thereafter
<br>arg$ : reference the arguments object from within a breakpoint

<H3> <A NAME=tips> Tips for Avoiding Line Numbers </A> </H3>

<P>
If you haven't spent time using the ed editor, you may find this program awkward.
It seems like you have to use line numbers,
which are ever changing as text is edited.
However, line numbers are rarely needed in practice.
Here are some tips for avoiding them.

<P>
If you want to read the entire file, type ,p.
Of course a large document will fly past your screen,
but there's an easy way to step through page by page.
Start with 0z24 to get the first 24 lines.
Then the z command will give you the next 24, and the next 24, and so on.
You may want to use 22, or 23, or whatever makes sense relative to your screen.
Another approach is to simply hit return, again and again, and proceed line by line.

<P>
Once you are use to regular expressions, you can jump to any part of the document,
even a large document, in record time simply by searching for a unique text fragment.
This comes with practice.
If your search string is not unique,
you may have to search two or three times to find the desired paragraph.

<P>
If you want to mark certain lines of text, please don't try to remember the line numbers.
Use the k command to mark them.
For example, use ka and kb to mark the start and end of a block of text,
while kc marks the new location.
The move command is then 'a,'bm'c - with absolutely no line numbers.
This is standard ed fare.

<P>
To look for links on a web page, search for the left brace.
Yes, you may stumble across a literal left brace in the text, but this doesn't happen very often.
You might access a particular link by typing /{Next}/g.
Similarly, you can look for input fields by searching for the less than sign.
This will make sense as you read about the representation of web pages below.
And of course, multiple operations can be scripted, an important feature of edbrowse.

<H3> <A NAME=mlist> Mailing List </A> </H3>

<P>
There is a mailing list for users of edbrowse and other command line utilities.
You can join by sending mail to
<A HREF=mailto:commandline-subscribe@yahoogroups.com?subject=Subscribe>
commandline-subscribe@yahoogroups.com</A>.

<H3> <A NAME=wiki> Edbrowse Wiki </A> </H3>

<P>
There is a wiki devoted to edbrowse,
including tips and tricks, and sample .ebrc configurations and functions.
See <A href=http://edbrowse.org>edbrowse.org</A> for more information.

<hr>
<H2> Chapter 3, The Editor </H2>

<H3> <A NAME=dev> Important Deviations From /bin/ed </A> </H3>

<P>
Certain search/substitute commands may behave differently under this editor.
This is because the regular expressions are interpreted
by the perl compatible regular expression (pcre) library,
rather than the traditional regexp library.
Hence regular expressions have more features, and more power,
than the regular expressions employed by /bin/ed.
The syntax is also somewhat different.
For instance, perl uses bare parentheses where ed uses escaped braces --
to delimit sections of matched text.
And perl uses $1 ... $9 to reference the matched substrings,
whereas ed uses \1 ... \9.
Also, perl supports the i suffix, for case insensitive search,
along with the traditional g suffix for global substitute.
There is no reason to describe all the nuances here.
Please read the perlre man page `man perlre' for a full description
of regular expressions under perl.
Once you are accustomed to their power and flexibility,
you'll never go back to ed.

<P>
Great.  You've read the perlre man page, and you're back.
Here are a few changes that I've made to perl regular expressions.
I have found that ( and ) are almost always meant to be literal,
as in searching for myFunction(),
so I reverse the sense of escaped parentheses in perl.
That is, ( and ) now match the literal characters,
and \( and \) are used to demark substrings of the matched text.
These substrings are then referenced, in the replacement string, by $1 through $9.
Similarly, | means a literal |, and \| is alternation.
I also change the sense of &amp;, on the right hand side,
to mean what it means in ed.
I leave ^ $ . [ ] + * ? and {m,n} alone, to be interpreted by perl,
as described in the perlre man page.
However, if * is the first character, it is treated as a literal star.
This makes sense, as there is no previous character to modify.
Some versions of ed do this, some don't.
This is convenient; when you want to replace * + or ? you don't have to escape it just because it is a modifier.
Similarly, an open bracket by itself is treated as literal.
These changes to regular expressions, to look more like ed, may be confusing
if you are a perl expert,
however, these changes make this
editor easier to use for everyone,
especially the experienced ed users.
Below are some additional differences between this program and /bin/ed.

<UL>
<LI><P>
Lines beginning with # are ignored, making it easier to comment your edbrowse scripts.
The # character has no special significance in the middle of a line.

<LI><P>
Lines beginning with ! implement a shell escape.
The ! character has no special significance in the middle of a line.
The ! alone spawns an interactive subshell - type exit to return to edbrowse.
The work "ok" is printed when the shell command is finished -
thus you can tell when a no-output command is done.

<LI><P>
Type `cd dirname' to change directories.
The new directory is always printed.
Type cd alone to find out where you are.

<P>
Unlike bash, edbrowse does not retrace your steps back through symbolic links.
Thus .. is always the physical parent directory.

<P>
If the string contains $ [] * ? or a leading ~,
environment variables are expanded, and globbing is performed.
Thus cd ~/work takes you to the work directory under your home directory.

<P>
This command does not change any filenames that may be active.
You can edit foo, cd .., and write,
and foo will be copied to the parent directory.
That's probably not what you want, so be careful when changing directories.

<LI><P>
r operates on the current line by default,
rather then the last line.
Use $r to read a file at the end of your working text.

<LI><P>
The w+ command appends to the file.
Some versions of ed use w&gt; for this operation,
but for 40 years &gt; has been the industry standard for write with truncate,
so using &gt; for append is somewhat confusing.
And w&gt;&gt; is just too clunky, so I use w+.

<LI><P>
w/ writes the data into a file whose name is the last component
of the current file name.
This is useful when you've just downloaded this.that.com/foo/bar/package-2.7.7-22.tar.gz,
and you want to write the file locally, but don't want to retype the stuff at the end.
Alternatively, f/ changes the filename, keeping only the last component.

<LI><P>
Whenever a file is read from or written to disk,
$var, in the filename, is replaced with the corresponding environment variable.
Thus you can edit your address book at any time via `e $adbook',
provided $adbook has been set in your environment.
Constructs such as ${foo}bar are supported.
Also, a leading ~/ is replaced with $HOME/,
making it easy to edit files in your home directory
such as ~/.profile.
Or use ~user for another user's home directory.

<P>
Shell meta characters are expanded, provided the result is one file name.
You can read or write a file by typing a minimal portion of its name.
Neither $variables nor stars are expanded for files on the command line,
as this expansion is already done for you by the Unix shell.
Windows users should compile using the setargv.obj utility,
which performs wildcard expansion on command line arguments.
Thus you should be able to edit *.c in any operating system
and get all the C source files in the current directory.

<P>
Variable substitution and globbing of filenames can be completely suppressed by a leading backquote.
If you really want to read a file called *a?, type r `*a?.
You can escape an individual shell meta character with the backslash, as in fun\*house.

<LI><P>
Many versions of ed place a $ at the end of a listed line,
but this is not one of them, at least not by default.
Use the command `endm' to place end markers around listed lines.
Listed lines begin with ^ and end with $.

<LI><P>
Capital Q does not quit the editor absolutely.
This is because I often hit caps lock by mistake,
or even shift q by mistake,
and if I've forgotten about some important changes that I've made,
those changes are gone!
This seems contrived, like it would never happen,
but it does,
so I disabled capital Q.
Type qt to quit absolute.

<LI><P>
Capital J joins lines together with spaces between them.

<LI><P>
x (encryption) is not implemented.

<LI><P>
P (prompt) is not implemented.

<LI><P>
missing line numbers before or after the comma are assumed to be 1 and $.
This is consistent with ,p -- to print the entire file.

<LI><P>
You cannot enter one command across two physical lines
by putting a backslash at the end of the first line.
And there's no need to in any case, because perl supports \n translation.
To split a line in the middle of the word doghouse, type:
<P>
s/doghouse/dog-\nhouse/

<LI><P>
Only the first 500 characters of a line are displayed.
The rest of the line is in the buffer, and can even be modified via a substitute command,
but if you want to see it, you will need to split it,
as in the doghouse example above.
You can change the number of characters displayed by using the ll command.

<LI><P>
a+ adds text, like a, but also adds the line you last typed,
when you thought you were in append mode, but you weren't.

<LI><P>
This program is less tolerant of whitespace than /bin/ed.
<br>
57 , 63 p      will not fly.

<LI><P>
When searching for a regular expression, both ed and edbrowse will wrap around the buffer, back to the beginning.
Thus /./ on the last line prints the first line.
This behavior can be turned on and off via the sw command.
Some people prefer to stop searching at the end of the buffer, without going back to the beginning.

<LI><P>
A single % on the right hand side of a substitution is replaced with the last right hand side.
Some versions of ed do this, some don't.

<LI><P>
s, is shorthand for s/, +/,\n
This is used to split lines at phrase boundaries.
You can also use s. to split a line after the first period -- at a sentence boundary.
s; s: s) and s" can also be used.
s,3 splits the line after the third comma.
You might need to use s.2 if the sentence begins with Mr. Flintstone.

<LI><P>
Type s by itself for s//%.

<LI><P>
The sg command makes searches and substitutions global across editting sessions.
This is a toggle, so type sg again to keep search strings local to their sessions.
As with any toggle, you can enter sg+ or sg-.
If you want to look at all instances of "foo" in all the files in the current directory,
and change some of them to bar at your discretion,
edit *, then enter sg to make substitution strings global to all edit sessions.
In the first session, search for foo, and replace some of them with bar.
Type e2 to move to the next session, whence you can search using slash alone,
because the string "foo" is applied to all sessions.
Similarly, you can use % to refer to "bar".
The sg- command returns this editor to its local behavior,
where each file has its own search/replace strings.

<LI><P>
Errors associated with reading or writing files, or switching sessions,
are always printed.  Other errors elicit the usual question mark,
whence you must type h to read the explanation.
Type capital H if you always want to see the error messages.

<LI><P>
In most versions of ed, the command z7 means .,+6p,
making the current line +7.
This is inconsistent, having one and only one ed command that leaves dot
somewhere other than the last line printed.
The confusion is compounded when z prints the last lines in the file,
whence dot actually is the last line printed.
In this program z7 means +,+7p,
and the current line becomes the last line printed, just like the other commands you know and love.
Without a number, z prints the previous number of lines.
Thus you can read your file a chunk or screen at a time.

</UL>

<P>
Subsequent sections describe
new and interesting features, completely foreign to ed.
These include the simultaneous edit of multiple files
similar to emacs and vi,
and the ability to browse an html file and edit its fill-out form.

<H3> <A NAME=brace> Balancing Braces </A> </H3>

<P>
The capital B command is of interest to programmers,
and will probably not be used by casual home users.
It locates the line with the balancing brace, parenthesis, or bracket.
Consider the following code fragment.

<PRE><font size=3 face=Arial,Helvetica,sans-serif><code>    if(x == 3 &amp;&amp;
    y == 7) {
        printf("hello\n");
    } else {
        printf("world\n");
        exit(1);
    }
</code></font></PRE>

<P>
The capital B command, on either the second or the last line,
moves to the middle line "} else {",
because that balances the open brace.
On the first line, B moves to the second line,
which balances the open parenthesis.
The second line balances {, rather than ),
because braces have precedence over parentheses,
which have precedence over brackets.
You can force a parenthesis match by typing B),
which moves from line 2 back to line 1.

<P>
The B command on the else line is ambiguous -
not knowing whether to look backwards or forwards.
Type B{ or B}.

<P>
You can explicitly balance &lt;&gt;, as in multiline html tags,
or `', used in some preprocessors such as m4.

<P>
Comments or literal strings that contain balancing punctuation marks will
definitely throw edbrowse off the track.
If you are the author of the source,
you might want to avoid braces in comments,
or use comments to keep braces in balance.

<P>
static char openstring[] = "{block"; /* closing } is found elsewhere */

<H3> <A NAME=cx> Context Switch </A> </H3>

<P>
This program allows you to edit multiple files at the same time,
and transfer text between them.
This is similar to the world of virtual terminals (Linux),
where you switch between sessions via alt-f1 through alt-f6.
In this case you switch to a different editing session via the commands
e1 through e6.
Note that `e 2' edits a file whose name is "2",
whereas `e2' (without the space) switches to session 2.
Similarly, you can read the contents of session 3 into the current buffer
via r3, or write the current buffer into session 5 via w5.
The latter command will produce a warning if session five already exists,
and you have made changes to its text, but have not saved those changes.
In other words, you are about to lose your edits in session 5.
Typing h will produce the explanation:
"Expecting `w' on session 5".

<P>
If you quit a session you are moved to the next valid editing session,
wrapping around to session 1 if necessary.
The program exits when the last session quits.

<P>
Warning, the program contains a limitation regarding the undo command.
If you switch to another session, then switch back,
you cannot undo your last edit.
You'd think this would be easy to fix,
but it is trickier than it seems, so I haven't gotten around to it.
Make sure everything is copacetic before you switch to another session.

<P>
Use the bflist (buffer list) command to see a list of all the editing sessions that are currently open.
Edbrowse presents the session number, and the title if the session is a web page, or the file name.

<P>
Let's run through a cut&amp;paste example.
You are editing file foo in session 1, and you realize
that a paragraph from file bar would fit perfectly right here.
Here is how it might look.
Lines beginning with &lt; are the user's input,
and lines beginning with &gt; form the program's responses.
The # sign delimits my injected comments,
which would not normally appear in the middle of a line.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>&lt; e2   # switch to session 2
&gt; new session
#  Unlike ed, the r command does not establish a file name, even if the
#  buffer is empty.
#  Thus "r bar" is safer than "e bar".
#  The text is not linked to the file bar,
#  and we cannot accidentally corrupt this file.
#  After all, we don't want to change bar, we just want to steal from it.
&lt; r bar
&gt; 28719
&lt; /start/
&gt; This is the start of the cool paragraph that you want to copy.
&lt; 1,-d  # don't need the stuff before it
&lt; /end/
&gt; This is the end of the cool paragraph that you want to copy.
&lt; +,$d  # don't need the stuff after it
&lt; e1
&gt; foo
&lt; r2
&gt; 3279  # size of text read from session 2
&lt; w  # write foo, with the new paragraph included
&gt; 62121
</font></PRE>

<P>
The following moves the data from one file to another.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>&lt; e2
&gt; new session
&lt; e bar  # this time I'm going to change bar
&gt; 28719
&lt; /start/
&gt; This is the start of the cool paragraph that you want to move.
&lt; ka  # mark the paragraph
&lt; /end/
&gt; This is the end of the cool paragraph that you want to move.
&lt; kb
&lt; 'a,'bw3
&gt; 3279
&lt; 'a,'bd
&lt; w  # write bar, without the cool paragraph
&gt; 25440
&lt; q
&gt; no file  # now in session 3
&lt; e1
&gt; foo  # back to session 1
&lt; r3
&gt; 3279
&lt; q3  # quit session 3 remotely, while still in session 1
&lt; w  # write foo, with the new paragraph included
&gt; 62121
</font></PRE>

<P>
An e command by itself prints the current session, in case you've forgotten.
This is similar to f, by itself, which prints the current file.

<H3> <A NAME=usage> Usage </A> </H3>

<P>
type `edbrowse -h' to produce the following usage message.
You will see the -f, -fm, and -m options used in several different ways;
just ignore them for now.
These options cause edbrowse to act as a mail retriever or interactive
mail client.
This will be discussed later.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>edbrowse  -v    (show version)
edbrowse -h (this message)
edbrowse -c (edit config file)
edbrowse [-d#] -f[#] (fetch mail) 
edbrowse  [-d#] -[p]m    (read pending mail)
edbrowse  [-d#] -[p]fm[#]    (fetch mail and read pending mail)
edbrowse  [-d#] -m[#] address1 address2 ... file [+attachments]
edbrowse  [-c configfile] [-b] [-e] [-d#] file1 file2 ...
</font></PRE>

<P>
The -dx option sets the debug level to x, where x is between 0 and 9.
The default is -d1,
which prints the sizes of files as they are written and read.
Some people like -d2, which prints the URLs
as you jump to new web pages or submit forms online.
Unless you are a developer, you probably don't want to go any higher than that.
Remember, the debug level can be changed interactively by using the dbx command (x between 0 and 9).
You can direct debugging output to a file by `db&gt;filename',
and you probably want to for db5 or above.

<P>
The -e option causes edbrowse to exit when it encounters an error.
This is usually used by batch scripts.
If there is a problem, you don't want to march on, executing the rest of the edbrowse commands.
Note that set -e has the same effect in a bash script.

<P>
Use -c alone to suppress processing of, and edit, the .ebrc configuration file.
(This config file will be described later.)
You might want to do this if your config file has syntax errors, which are displayed when edbrowse starts.
Your config file is automatically loaded into buffer 1.
Make changes, save the file, and type `config' to reload the file.
If there is another error you may need to make another change, save, and config again.
Continue until there are no errors.
Processing of the config file stops at the first error, so you really want a clean run.

<P>
From within edbrowse, a file name of -c is treated as the config file.
You can switch to a new session, view, edit, save, and reaply the config file without ever leaving edbrowse.

<P>
If the first arguments are -c filename, edbrowse uses filename as its config file, rather than the default file under your home directory.
As long as this edbrowse process runs, -c referse to the file specified on the command line,
as does the config command, which reprocesses the config file.

<P>
The -b option browses each file or url on the command line, or plays it if a plugin so indicates.
Without -b, only the urls are browsed.
edbrowse this.example.com reads the data from the web page, prints the size in bytes, browses the page, and prints the size of the rendered text.
The -b option causes the same thing to happen on a local file, e.g. if you have html files on your computer.
It also activates any plugins that might render your file, e.g. pdf, or play your file, e.g. mp3.
Plugins will be described later.

<P>
The arguments to edbrowse are the files to edit.
Edbrowse reads these files into corresponding sessions
and starts in session 1.
If there are no arguments, edbrowse starts in session 1
with no text and no associated file.
If the file is a url, then that web page is fetched from the internet and browsed.
Finally, if the file begins with a less than sign,
edbrowse "&lt;func arg1 arg2",
then the named edbrowse function is run with its arguments.
These functions are part of your config file and will be described later.
The function runs in its own session, as though it were a file or a url.
Often the function will load a file or url on your behalf, so that is usually what you want.
Files, urls, and functions can be intermixed on the command line.
They are processed in order.

<P>
If you like this program, and you want it to be your primary editor,
you can set the following bash alias.

<P>
alias e="/usr/bin/edbrowse"

<P>
If you do this you can use `e filename'
to edit a new file, whether you are inside edbrowse or at the shell prompt.

<H3> <A NAME=bin> Binary Characters </A> </H3>

<P>
At all times, even when entering a file name, this program scans its input
for binary codes.
Use the three character sequence ~bd to enter the nonascii character 0xbd,
which is the unicode for 1/2.
Assuming utf8, you will need to enter ~c2~bd for 1/2.
Similarly, if you list a line with lna active, the 1/2 character
is displayed as ~c2~bd.
All nonascii and most control characters
are entered and displayed in this manner.
Tab and newline must be entered directly from the keyboard.
Tab and backspace are displayed as &gt; and &lt; respectively.
If the following line is entered,

<P>
Hello~07 ~x is ~c2~bd of y

<P>
And then listed, you will see the very same text,
but there is a bell and a 1/2 character inside.
The ~x is not encoded into anything, because x is not a hex digit.
To force a ~, even though there are hex digits following,
use two tildes, ~~.

<P>
for international text,
there are easier ways to enter accented letters into your document,
assuming those letters are in your native language and your keyboard has been configured appropriately.
In other words, there are typically keyboard shortcuts for your accented letters, so no need to mess with utf8.
Use ~u to enter a high unicode outside of your native language and beyond your keyboard shortcuts.
The unicode is in hex.
Thus ~u3b3; is the Greek letter gamma.
The semicolon is optional.
You only need it if another hex digit follows, as in ~u3b3;4 for gamma4.
hello~u1f600world puts a grin emoji between hello and world, because w cannot be confused with a hex digit.

<P>
Regular expressions can be entered via hex or octal.
This program converts ~xx, as a hex value,
and the perl regexp machinery converts \nnn, as octal.
Thus any of the following will undos a file.
The first is translated by edbrowse, the second and third by perl regular expressions.

<P>
,s/~0d$//
<P>
,s/\15$//
<P>
,s/\r$//

<P>
Embedded escape characters are always displayed in hex,
whether the line is listed or not.
Most terminals and terminal emulators, including the Linux console,
interpret various escape sequences as control commands.
Thus an errant escape sequence from a binary file could send your terminal into an unexpected state,
making recovery difficult.
Use /usr/bin/reset to put the terminal back into a sane state.
Thus it seems prudent to render escapes as ascii characters all the time.
If you have no idea where that ~1B came from, it's probably a literal escape character
in your file.
Control n and control o are also printed in hex, ~0E and ~0F, as they can also derail many terminal systems.

<P>
Returns and nulls are also converted into hex all the time.
Thus an embedded return will not make one line look like two lines.
You might see this when importing a dos or Windows text file.
Every line ends in ~0d.
Issue one of the three commands shown above to undos the file.
However, edbrowse usually converts these dos files automatically for you, unless you have disabled this feature with the iu command.

<H3> <A NAME=bfile> Binary Files </A> </H3>

<P>
Data is considered binary if it is sufficiently large
(more than 50 bytes),
and it contains a significant fraction of non-ascii or null characters (more than 25%).
International text may contain scattered binary codes for accented letters,
but most of the characters should still be ascii.
Therefore binary data is not international text.
In fact you probably won't be able to display or edit binary data effectively,
at least not by this program.
But hey, don't let that stop you.
As an exercise, create an executable program that prints "hello world",
then edit the executable using this editor.
Look for the string "hello world" and replace world with jorld.
Write the file and run the executable.
You should now see "hello jorld".

<P>
When binary data is first read into the buffer, you will see the words "binary data".
After that the buffer remains "binary", even if you delete all the data and read in ascii text.
You must use the `e' command to get a fresh text buffer.

<P>
For the most part it doesn't matter if the data is binary or text.
Either way you can display and edit the data, and write it to a file.
However, edbrowse tries to "do the right thing" for dos text files.
It converts crlf to and from newline if it believes the file is text;
and it leaves binary data alone.
This happens automatically under dos; it can be supressed with the iu command under unix, if you really want to see the carriage returns.

<P>
Although this approach is satisfactory for utf8,
it can fail for a large iso8859-1 file with lots of accented letters.
Such looks binary, even though it is ascii.
You can disable binary detection with the `bd' command, whence your file will remain ascii.
This is a corner case, since utf8 is nearly universal.
Therefore, the bd command is deprecated, and could go away in a future version of edbrowse.

<H3> <A NAME=dir> Directory Scan, File Manager </A> </H3>

<P>
If you edit a directory
you will see a list of all the visible files in that directory
in alphabetical order,
according to your locale.
This is the same order as /bin/ls, and is determined by the environment variable $LC_COLLATE.
Set LC_COLLATE=C for traditional ascii order.
Note: the Raspberry Pi (raspbian) seems to have a bug, wherein LC_ALL trumps LC_COLLATE. It's not suppose to but it does.
So unset LC_ALL and set the other LC_ variables individually, according to your taste.
Make sure LC_MESSAGES is set, so you can interact with linux in your language.

<P>
Use the `hf' option to see the hidden files, on Windows or Unix.
(This includes the parent directory ..).
Type g to go to one of these files or sub directories.
Type ^ to get back to where you were.
This is consistent with the browser,
where g is the go command and ^ is the back key - more on this later.
Thus you can traverse an entire directory tree
as though you were inside a file manager.

<P>
Like the browser,
and like other file managers,
the go command will invoke a plugin if that is indicated by the suffix of the file.
An mp3 file plays, and a pdf file is rendered into readable text.
Use the `pg' toggle command to disable plugins if you don't want this automatic behavior.
More on plugins later.

<P>
The capital M (move) command moves this directory to another session and backs up.
Once again, we will find the same command in the browser.
If you were in directory foo, and descended into directory bar, and you wish to look at both of them in parallel, type M, and bar moves to a new session, and you are back in foo, on the line that contains bar.
You can now switch between the two directories; foo is not hidden on the stack.
Use M6 to move the directory specifically to session 6; this will clobber session 6.
If unsure, type M.
Note, this command works just as well with files.

<P>
Like `ls -F', a subdirectory is indicated by a trailing slash.
This slash is not part of the filename.
Similarly, named pipe is indicated by |,
symbolic link by @,
block special by *, character special by &lt;,
and socket by ^.
If a regular file ends in one of these characters, it may confuse you,
but it won't confuse this program.
Edbrowse knows whether that trailing | is part of the filename
or a pipe indicator.
Since each file is represented by a single line of text,
files with newlines embedded in their names cannot be accessed.

<P>
If you read a directory into a preexisting file it is just text.
You can't visit any of the underlying files, because they are just words.
You must edit a directory in its own session
or read a directory into an empty session
if you want to access the underlying files.
Note that you can write the buffer to another editing session,
and in that session the words are just words.
This distinction is important as we start to edit the text.

<P>
By default, directories are readonly.
If you try to delete a line, and hence the associated file,
it will tell you that you are still in directory read mode.
Type dw to enable directory writes,
and dr to make directories readonly again.

<P>
When directory writes are enabled,
you can remove files using the d command.
For instance, g/\.o$/d removes all the object files.
Since these edits have implications outside the scope of this program,
there is no undo capability.
When you make a change it is made.
With this in mind, I borrowed a good idea from Microsoft / Apple.
The deleted file isn't actually deleted;
it is moved to your trash bin,
located in $HOME/.Trash.
This is consistent with the Mac and many versions of Linux.
If you accidentally type ,d and remove all your files,
you can recover them from your trash bin.
You may want to set up a cron job that removes
all the files from your trash bin once a week.
This directory is created mode 700, so nobody else can look at your deleted files.
If you create this directory yourself, please make it 700.
After all, some of your deleted files might be private.

<P>
Because this operation is a move, rather than a true delete,
there are a few restrictions based on the operating system.
If your OS can move directories,
this program will be able to delete a subdirectory as easily as a file.
The entire subtree is moved to your trash bin.
Make sure your cleanup cron job is capable of removing directory trees, not just files.

<P>
If the trash bin is on another file system,
the file is copied, rather than moved.
It's practically the same; though the file will have your permissions and a current time stamp.
Directories cannot be copied in this way.
You must copy the directory tree yourself, then delete it,
using cp -r and rm -r.

<P>
Note that the dx command, wherein files are truly deleted, is the only way to free up space on the disk.
Symbolic links and special files are always deleted;
there isn't much point in moving a link to the trash bin.

<P>
If sessions 1 and 5 both contain directories, you can move the current file from the first directory to the second by .m5.
This does not move lines around like the editor; it moves the file from one session to another.
The kernel rename function is used whenever possible, to preserve the underlying directory tree, ownership, permissions, or special attributes.
This cannot be assured if the file is moved to another file system.
The file must be copied, then deleted, giving it your ownership and the current time.
In some cases, edbrowse may call upon /bin/mv to perform this operation.
You can move a range of files by 'a,'bm5, or files matching a regular expression by g/re/ .m5.

<P>
Use .t5 to copy the file to the directory in session 5.
Small files are copied by edbrowse; large files or special files or directory trees are copied by /bin/cp.
As with move, this will not overwrite an existing file.

<P>
"What's the point of all this?" you may ask.
"What's wrong with the shell?"

<P>
Nothing, as long as the file names are small and familiar.
But sometimes the file names are long and cumbersome,
and it is nearly impossible to type those names into the shell,
character for character, upper and lower case, with no mistakes.
Meta characters such as the * can help,
but only when the file you want has a name radically different from the other files in the directory.
This isn't always the case.
Suppose an application generates log files as follows.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>ProgramFooBar.-04-04-1998.06:31:59.log
ProgramFooBar.-04-11-1998.11:37:14.log
ProgramFooBar.-04-18-1998.16:22:51.log
</font></PRE>

<P>
How do you delete the old ones and keep the most recent,
or rename them to something more manageable?
Stars are a bit risky; you can access multiple files without realizing it.
And we're not even talking about those pesky files with spaces or invisible control characters in their names.
A file manager brings up the list of files,
whence you can click on the file you wish to view or edit or remove.
Edbrowse gives you that kind of power in a command line setting.

<P>
When the substitute command changes text, it renames the underlying file.
This won't move the file on top of another existing file,
so you can't lose any data this way.

<P>
The search and substitute commands ignore the trailing filetype characters.
If you want to rename a directory from foo/ to foobar/,
you can type s/$/bar/.
The bar will be placed at the end of the word foo, because the trailing / isn't really there.

<P>
Now suppose you want to run an arbitrary program on some of these files.
This could be a print utility,a compiler, whatever.
Sometimes you can rename the files for your convenience, then work in the shell.
But sometimes you don't own the files,
and sometimes they must retain their original names.
This happens when several html documents reference each other through hyperlinks,
using their existing filenames.
So you can't rename the files, yet you still want to run your program on one or two of them.

<P>
You can run any program on any file without retyping that filename via the shell escape.
Use kx to assign the label x to the file you are interested in.
This is standard ed syntax.
Then run !program 'x
to invoke your program on that file.
This sounds involved, but it is merely macro substitution, implemented in a few lines of code.
If 'x is present in a shell escape, and is not next to any letters or digits,
edbrowse replaces it with the text on the line labeled x.
If your filename contains spaces, run !program "'x",
to make sure the entire file name is one argument to the running program.

<P>
The token '. is replaced with the text on the current line,
and the token '_ is replaced with the current filename.
If you try to write a file, and remember that you left it readonly,
you can make it writable via !chmod +w '_,
then write the text to the file.

<P>
You can expand multiple tokens in one shell command.
Use kx and ky to mark two files that you want to compare, then run !diff 'x 'y.

<P>
This feature is not limited to directory scans.
You may be editing a simple file,
but you can still paste the contents of a line into your shell command.
Off hand I don't know why you'd want to do this,
but you can.

<P>
When in directory mode, the ls command displays various attributes of the file on the current line.
Type lsl for the length, lss for the approximate size, lst for the mod time,
lsp for the owner group permissions, lsi for the inode, lsk for the number of hard links,
lsy for the path associated with this symbolic link,
or lsm for the major and minor device numbers.
(The last 5 do not apply on Windows.)
These can be combined, e.g. lspk prints permissions and the number of hard links.
ls is the same as lsst, size and mod time.
Edbrowse prints ~ if the attributes cannot be acquired, e.g. asking the size of a broken symbolic link. The original symbol was a question mark, but that was easily confused with the question mark of an invalid command.

<P>
If you want file length and time to appear next to every file in a directory listing, then enter ls=lt.
The equals sign applies the ls directive to all subsequent directory scans.
Type ls= to turn this off.
Here is how the root directory might look with ls=lt.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>bin@/ 36864 Aug 31 2015 16:20
boot/ 4096 Dec  4 2014 07:54
cd/ 4096 Nov 30 2014 09:38
dev/ 3560 Sep  3 2015 05:00
etc/ 4096 Sep  3 2015 05:00
home/ 4096 Mar 10 2015 07:52
lib@/ 53248 Aug 31 2015 16:20
lost+found/ 16384 Dec 10 2014 15:32
opt/ 4096 Jan 12 2015 04:36
proc/ 0 Sep  3 2015 04:59
root/ 4096 Mar 10 2015 07:37
run/ 740 Sep  3 2015 05:00
sbin@/ 12288 Jul 14 2015 10:43
sys/ 0 Sep  3 2015 04:59
tmp/ 260 Sep 24 2015 11:05
usr/ 4096 Jan 12 2015 04:47
var/ 4096 Sep  3 2015 04:59
</font></PRE>

<P>
All entries are directories under the root directory,
thus they all end in /.
The birst entry is bin@/ because bin is a symbolic link to usr/bin
(most systems are configured this way),
and /usr/bin is a directory.
The size of /proc is 0, because /proc is a virtual filesystem.
The same holds for /sys.

<P>
If you search for the year 2014, you won't find anything, because the date and time are extras that are not part of the file name.
Searches and substitutes apply to file names only.
If you want to view the entire text as text, write it to a file, or to another session.

<P>
Files are sorted alphabetically, according to your locale.
Use the command sort+a for the standard alphabetical sort, and sort-a for a reverse alphabetical sort.
sort+t sorts by modification time, from oldest to newest, and sort-t reverses this, with the newest files at the top.
sort+s and sort-s sort by file size.

<H3> <A NAME=case> Upper/Lower Case </A> </H3>

<P>
The `lc' command converts a line to lower case,
and `uc' converts it to upper case.
Perl users will recognize these directives.
As an extension, `mc' converts to mixed case, capitalizing the first letter of each word,
and the d in mcdonald.

<P>
This is especially useful in a directory scan.
If directory write mode is enabled,
type ,lc to convert all the file names to lower case.
It's that simple.

<P>
If you want to upcase a particular word, type s/word/uc/.
This converts the word to upper case.
All the other substitution suffixes apply.
To change foo, Foo, FOo, and FOO to FOO, everywhere,
type ,s/\bfoo\b/uc/ig.

<H3> <A NAME=bl> Break Line </A> </H3>

<P>
The `bl' command breaks the current line into sentences and phrases,
each no more than 80 characters long.
You can change this default with the fll (format line length) command.
Some terminals are more than 80 characters wide.
Use ffl 80+ to allow a little overflow, so the next line isn't just one or two words.

<P>
bl compresses white space and strips white space from the end of the line.
If the line contains return characters,
these are turned into line separators -
places where the line will definitely be cut.
The only white space that is preserved is the tabs or spaces
at the beginning of the line, or after each return character.
This is a modest attempt to keep indented text indented,
if that makes any sense.
Once bl is issued,
physical lines will contain sentences or phrases, as delimited by punctuation,
or by the newline/return characters embedded in the original text, or by the format line length.
A long line that has no spaces cannot be cut, and ramins long.

<P>
If one of the original lines, delimited by newline or return,
is long, i.e. more than 120 characters,
it is assumed to be a self-contained paragraph,
and a blank line is added before and after.
Thus a disassembled paragraph containing 20 sentences
does not simply flow into the next disassembled paragraph containing 18 more sentences.
An empty line separates the two paragraphs.
This is only applicable if bl is applied to a range of lines,
or the entire document,
as might occur when making an outside document readable.

<P>
Don't apply the bl command to a preformatted section,
such as a table or ascii art.
If you're not sure what to expect,
i.e. you didn't write the file,
scan through it first,
and apply bl to the range of lines that actually represents text.

<P>
You might be tempted to use bl to make Word documents readable, but use catdoc instead; it does a better job.
This is a must-have program for people who want a command line environment.

<P>
This function is also used to format html text into sentences and phrases, as part of the browse process, producing lines no longer than 80 columns, or 80 utf8 characters.
Again, the fll command changes the format line length.
Each character counts as one column, so wide characters, e.g. a line with several emojis, might cause an overflow on your terminal.
Try fll 78 to give yourself some breathing room.

<H3> <A NAME=race> Race Conditions </A> </H3>

<P>
Suppose you are writing a file,
and edbrowse truncates the existing file,
then the computer crashes before edbrowse can write the new data.
When you bring your computer back to life,
your file is empty, zero bytes, and all your work is lost.
This is a narrow window to be sure;
the computer has to fail at precisely the wrong millisecond.
To guard against this improbable calamity,
some editors write your data to a temp file,
remove the true file, and move the temp file over to the true file.
This way your data cannot be lost.
Either the new or the old file will survive.

<P>
Then links came on the scene, first hard links, and then symbolic links.
Authors of ed and other editors had to scramble.
You can't remove a link, write to temp,
and move the temp file over to the link.
It isn't a link any more, it's a regular file,
and your filesystem is not what it use to be.
For one thing, the true file, pointed to by the (symbolic) link,
has not been changed at all.
This is not what you want!
So people rewrote there editors to disable this feature if the named file is
a link to some other file.
They had to revert back to the old truncate and write paradigm,
and hope that nothing bad happens in between.
And you know what, it never does.
The window is just too small.
With this in mind, edbrowse doesn't mess with temp files at all.
It truncates the file and writes out the data,
hoping nothing will go wrong during the critical millisecond.

<P>
Another race condition is more subtle.
Suppose you are editing a file and your friend,
or a system program, edits the same file.
Your file has actually been changed out from under you
while you held it in memory.
When you go to write your changes,
they will clobber any changes made by your friend, or the system utility.
Most text editors guard against this by watching the timestamp.
When you first edit the file foo,
an editor might remember the timestamp on foo.
then, when you are ready to write your changes,
it checks the timestamp, and if foo has been updated in the interim
it issues a warning message.
"File has been updated by someone else -
do you really want to write?"
This is a good feature,
but edbrowse doesn't have it, simply because I haven't gotten round to writing it.
This feature is not in high demand.

<hr>
<H2> Chapter 4, Web Browser </H2>

<H3> <A NAME=url> Accessing A URL </A> </H3>

<P>
Instead of invoking `e filename', you can invoke `e http://this.that.com/file.html',
and the editor will retrieve the named file using the http protocol.
The source (i.e. raw html) is made available for edit.
You can modify it or save it on your local machine.
Because the text was retrieve from another machine,
it cannot be written back to that machine,
hence the `w' command will not work.
You must specify a local file `w myfile.html',
or another editing session `w3'.

<P>
Note that this is not browsing, we are simply retrieving text from
another machine and editing it locally.
The text need not be html, it could be (for instance) a plain ascii document.
Many people put various types of files, even executables,
on their websites for retrieval.
Of course you wouldn't want to edit a binary file,
but you can still use this editor to retrieve the file and save it locally,
thus implementing an http download.

<P>
While inside the editor, you can type `e URL'
to leave the current buffer and
retrieve text from a remote machine.
Or you can type `r URL' to retrieve remote text and add it to the current buffer.
There is no `w URL' command, because the http protocol
does not allow you to write html source back to a remote machine.

<P>
As a convenience, any filename with two or more embedded dots
and a standard suffix (such as .com or .net)
is treated as a URL.
You can usually omit the http:// prefix.
Try invoking `e www.space.com',
as an example.
But again, you are looking at html source, which probably isn't what you want.
Browsing will be discussed later.

<P>
Whenever you retrieve data from a URL, the editor, directed by the http protocol,
might change the filename out from under you.
This is because the resource has moved
and the original computer was kind enough to give you the new address.
If debugging is set to 2 or higher,
you might see a series of three or four different URLs
as the editor is redirected across the internet.
Finally it retrieves your document,
and the current file name holds the correct and latest URL.
You might want to update your bookmark file accordingly.
Then again, you might not.
Sometimes the initial url is the "public" location of the web page,
and subsequent redirections occur inside the company.
In this case you'll want to retain the public url,
which will always work, even if the company relocates its web server.
Use your best judgment.

<H3> <A NAME=browse> Browse Mode </A> </H3>

<P>
If the editor contains html text, from any source,
even html that you wrote yourself,
you can type `b' to activate browse mode.
The command will be rejected only if the buffer is lacking in common html tags,
or the editor is already in browse mode.
You can force its hand by adding &lt;html&gt; at the top,
or any other tag we recognize -
it will always try to convert such a file.
Now the transformed text is readable, without any visible html tags.
In other words, &lt;P&gt; has been turned into a paragraph break,
&lt;OL&gt; has become an ordered list, and so on.
The filename is also changed; a .browse suffix has been appended.
If you write the transformed data, deliberately or accidentally,
the reformatted text will be saved in a new file,
whatever.html.browse,
without disturbing the original html.
This protects you if you are developing your own web pages.

<P>
When the browse conversion is executed, the system checks for
common syntax errors, such as a numbered list that is never closed.
If the file name is a URL, these syntax errors are not reported.
After all, it's not your web page, and there's nothing you can do about it.
However, if the web page is yours, as indicated by a local filename,
the first syntax error is displayed,
whence you can return to the html source and fix it.
Type `ub' to undo the browse conversion.
This takes you back to the raw html text under its original filename.
Now you can correct the error and try the `b' command again.
For your convenience, the label 'e is set to the line containing the error.
Repeat this process until `b' runs without errors.

<P>
If you try to quit, and the editor says "expecting `w'",
remember that you should be back in raw html before you issue the write command.
You could write the browsed text into file.browse,
and that will satisfy the "write" criteria,
but this isn't really what you want.
You've corrected errors in the html source, and that's what you need to save,
so remember to undo the browse reformatting before you write the file.

<P>
Note that you can issue the unbrowse command even if there were no errors.
If, for instance, you are looking at a well-constructed page
on some other website,
and you'd like to read or save the raw html, just type ub.
As an exercise, invoke `e www.space.com',
and use the `b' and `ub' commands to switch between
the raw html and the browsable text.

<P>
The browse reformatting is relatively simple.
Most tags are discarded, except those related to headers, paragraphs, and lists.
Subsections and list items are not indented.
The visual effect is not important,
and sometimes the extra spaces get in the way.

<P>
Because the physical line is the unit of thought,
i.e. the atomic construct that is modified or moved or copied,
lines are cut at approximately 80 characters, give or take a few,
usually at a sentence or phrase boundary.
Thus reading line by line often reveals a sequence of sentences,
or at least self-contained phrases within a larger sentence.
If you read this manual raw, without doing the browse on the file,
you'll see what I mean.

<P>
The layout of a preformatted section, &lt;pre&gt;, is honored,
although sequences of blank lines are compressed down to one blank line,
and whitespace at the end of lines is stripped.
This preserves the structure of street addresses,
code fragments,
poems,
and other preformatted blocks.

<P>
Tables are formatted like an ascii unload from a spreadsheet or sql database.
Pipes separate the fields on each row.
There is no whitespace around the pipes,
and the fields of a given row probably won't line up with the fields below.
It isn't pretty,
but you can't really trace down a column when using a line editor such as this in any case.
Better to write the table to a local file and use cut, sort, join, etc.
Here is a sample table.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>part number|quantity|price
2635|2|$34.80
1398|1|$67.50
8118|5|$125.00
</font></PRE>

<P>
Empty fields at the end of a row are dropped.
These are almost always images -- sometimes an entire row of images --
sometimes an entire table of images.

<P>
Note that the browsable text is readonly.
After all, it's not the "source" -- why should you edit it?
There are ways to enter and edit the input fields of an on-line form,
but this will be discussed later.
For now, you can think of the text as readonly.
Issue a copy or insert or substitute command,
and you'll get an error.

<P>
If you do want to edit the text, as pure text,
enter the `et' command (edit as text).
You will not be able to return to the html that produced this page,
nor can you follow a hyperlink or submit a fill-out form.
The browsable text has become plain text, with no internet semantics.

<P>
The command `b file.html' is shorthand for `e file.html', followed by `b'.
Remember that the ub command reverses the browse conversion, and reproduces the original html,
as though you had entered `e file.html' alone.

<P>
If a url is opened from the command line,
as in `e www.google.com', it is automatically browsed.
Type `ub' to revert back to the raw html.

<H3> <A NAME=math> Technical, Math </A> </H3>

<P>
Most people never read technical web pages, but if you do...

<P>
A subscript, as indicated by html tags, is enclosed in brackets.
Thus x&lt;span class=sub&gt;n&lt;/span&gt; becomes x[n].
(span.sub should render the subscript properly in your css file - lower and in a smaller font.)
This transformation is not done if the subscript is a one or two digit number.
Thus x subscript 1 is rendered x1, just like your professor would say it.
This is not ambiguous, as you might first think;
only programmers use x1 as a variable name, not mathematicians.
If you see x1 in a formula, it means x subscript 1.
Even 17a3b3 is not ambiguous;
it is a translation of 17 times a[3] times b[3].

<P>
Superscripts, as indicated by &lt;span class=sup&gt;, are enclosed in parentheses with a preceding arrow.
The parentheses are omitted if the superscript is a number.
Thus x cubed looks like x^3,
while x to the n-1 power looks like x^(n-1).
Again, your css file should define span.sup.

<P>
Edbrowse supports the translation of certain &amp;word; constructs in html,
such as &amp;lt; for the less than sign,
along with &amp;#code: or &amp;#xcode; for direct inclusion of unicodes in html.
The Greek letter theta can be encoded as &amp;theta;
or &amp;#952;,
or &amp;#x3b8;.
In each case it is translated into the utf8 sequence for theta.
Your screen reader should be able to render this as the word theta,
perhaps under the direction of a configuration file.
Such translations are left to the adapter;
edbrowse merely turns html into the proper utf8 sequences.

<P>
These translations are designed to work with the pages of the
<A HREF=http://www.mathreference.com> Math Reference Project</A>,
an archive of advanced mathematics
that attempts to be both sighted and blind friendly at the same time.

<H3> <A NAME=title> Title, Description, Keywords </A> </H3>

<P>
While in browse mode, the commands ft, fd, and fk
produce the title, description, and keywords of the current web file respectively.
These are normally not visible to the user.
The title describes the web page in 80 characters or less.
The description is a more complete explanation,
which is displayed by a search engine such as yahoo or altavista.
The user reads the description via the search engine and decides whether to read that web page.
Finally, the keywords are used by search engines to facilitate keyword searches.
Like the rest of the browsable text,
these three attributes are readonly.
If it is your web page,
you can modify them by returning to the raw html.
Web designers should pay close attention to the description and the keywords,
else your pages might not be accessible via the standard search engines.

<P>
The fu command prints the file's url.
This may be encoded, with a lot of percent signs.
It does not change, even if you change the file name.
This is the same string that is put into a bookmark if you issue the A command on a line without any links.
See Web and Email Addresses below.

<H3> <A NAME=rf> The Refresh Command </A> </H3>

<P>
Type `rf' to refresh the current file.
This rereads the file or url into the current buffer.
It does not push a new editing session onto the stack.
This is analogous to the refresh button on Netscape and Explorer.

<P>
If a web page is updated every minute, e.g. with the latest stock prices for your favorite companies,
you can type rf to fetch the latest copy of this web page.
This assumes the intervening internet servers are not caching the web page
and handing you the same out-of-date copy over and over again.

<P>
On your local machine,
you can use this feature to read the latest version of a dynamic file,
such as a log file.
Or you can reread a directory,
to incorporate any new files that have been placed in that directory.
For example, you might use the shell escape to execute
`cat x y &gt;z',
yet z will not appear in your directory scan until you type rf.

<H3> <A NAME=hlink> Hyperlinks </A> </H3>

<P>
A link to another web page is enclosed in braces, like this:

<P>
{Recent reports} suggest a connection between health and intestinal bacteria.

<P>
Behind the scenes, "recent reports" is linked to
http://www.sciam.com/article.cfm?id=jeremy-nicholsons-gut-instincts,
but you don't see that unless you activate the link
or view the raw html.

<P>
Of course the browsable text might also contain words inside braces,
especially if the web page is technical in nature.
There is some ambiguity,
but it is often clear from context.
{More information} is probably a link,
whereas ${HOME}/.profile is probably not.

<P>
Some web pages present a series of icons
that are actually links to other pages.
You click on a picture, rather than a phrase, to go somewhere else.
These icons are suppose to be intuitive.
Sometimes they are - sometimes they're not.
Sometimes the web designer is kind enough to supply
a text phrase that roughly describes the image.
In this case the phrase is used as the link.
If there is no alternate phrase,
the filename of the hyperlink reference is used.
This name can be surprisingly helpful,
or it can be utterly useless, as in "index.html".
If this name cannot be determined,
the generic link {image} is used.
In this case you will have to go to the web page to find out what it contains.

<P>
Note, an image that is not part of a hyperlink has its alt text enclosed in brackets,
as in [girl with a long red braid].

<P>
To follow a link, enter the `g' (go) command.
Yes, `g' also initiates a global substitute command,
but only when it is followed by a regular expression.
By itself, g follows the link on the current line,
g2 follows the second link on the current line,
and 4g follows the link on line 4.
g$ activates the last link on the line.
If a link spreads across multiple lines, you must be on the first of these lines,
the line containing the left brace.
Use g? to print the url - where you will go if you type g.
g- goes to the link, but does not browse,
or render (e.g. a pdf file), or play (e.g. an mp3 file).
This bypasses your plugins and retrieves the raw file.

<P>
The g command can also act on a link that is written in raw text,
as long as it looks like a valid url.
If your friend sends you an interesting url via email,
and you save it to a text file,
you can go to that link,
even though the file is not html and you've never issued a browse command.

<H3> <A NAME=ilink> Internal Links </A> </H3>

<P>
Although most links lead to other web pages,
some links point to other sections within the current web page.
Again, you might be able to tell by context.
Links in the table of contents are usually
shortcuts to chapters in the current document.
The same holds for links that look like:
see {Appendix I},
or, see the section on {Hardware Configuration}.

<P>
The g command follows an internal link or an external link.
Either way you find yourself in a different place.
However, if the link is internal,
you are still browsing the same file.
In fact, the only thing that has changed is the current line number.
The new line is displayed,
and should correspond to the link you activated.
Often the words are the same.
Activate {Appendix I}, and you'll probably see the section heading "Appendix I".
Enter z10 to read the first few lines of the appendix.

<H3> <A NAME=back> The Back Key </A> </H3>

<P>
If you edit a new file via the `e', `b', or `g' command,
and you already have text in the buffer,
that text is bundled up and pushed onto a stack.
You can pop the stack by issuing the `^' command.
This is suppose to be intuitive --
the up arrow points to the previous page that rolled off your screen.

<P>
This feature seems rather silly if you're just editing files,
but it makes sense when surfing the net.
Often we descend through two or three links,
only to find ourselves at a dead end.
"I didn't want to go here."
Hit the back key again and again, until you reach familiar territory.
You can now proceed in a new direction.
The command ^3 or ^^^ backs up through three pages.
Don't use this iterative feature unless you know exactly how many times you need to back up.

<P>
Note that the entire state of an editing session is saved and reproduced,
including the file name,
the last search/replace strings for substitutions,
the hyperlinks and forms,
the compiled javascript,
everything!

<P>
The stack should not be confused with parallel edits,
as described in an earlier section.
In fact each editing session, e1 e2 e3 &#8230;, has its own stack.
Parallel sessions are appropriate when you need to move back and forth between two files,
or cut&amp;paste between them.
However, one session, with its internal stack,
is usually sufficient to surf the net.

<P>
If a browse command fails completely,
giving you a rather uninteresting empty buffer,
the stack is popped automatically,
taking you back to the previous web page.
Now you can retry the link by typing `g' again,
or follow a different link on the page.
Note that a browse command can fail, and still give you text explaining why it failed,
if the remote server is well-designed.
In this case you may see the error message "file not found",
yet you will be viewing a new web page, which explains the problem.
After you've read the explanation,
follow its directions,
or type ^ to back up and try again.

<P>
If you are presented with a number, even 0, the stack has been pushed, and you are in a new file or url.
The number is the size of the new file.
Use the ^ command to get back.
If there is no number, merely an error message,
then edbrowse did not create a new buffer.
It probably didn't get that far.
Typing . will produce the same line you saw before.

<P>
Use the nostack prefix to replace the current web page, rather than pushing it onto the stack.
For example, `nostack b www.ibm.com' replaces your current web page with ibm.com, and ^ will not take you back to where you were, because that page is gone.
Most people will not use this feature very often.

<P>
Following an internal link to another section in the current document
does not push anything onto the stack.
In other words, ^ will not take you back to where you were.
In fact, it will take you up to the previous web page, which is not what you want.
Instead, a separate per-page history is accessible with the &amp; key.
You can use &amp;3 or &amp;&amp;&amp;, similar to ^, but only do so when you know
how far back you want to go.
An alternative, if you often want to go back to the table of contents, is to
mark the current position with kr, then return to it via the label 'r.
Even with this label set, &amp; is often more convenient, since it takes you back to the last heading you jumped on, whence you can procede down the table of contents to the next section that interests you.

<H3> <A NAME=move> The M Command </A> </H3>

<P>
If you want to read and/or interact with several web pages in parallel,
pages that would normally stack up,
you can move each one to another session using the capital M command.
The tags and links are transferred along with the rendered text.
Once the web page has moved to another session,
edbrowse issues the ^ command for you.
Now you are back to the previous page.

<P>
It is generally unsafe to make a copy of a running web page,
with all its javascript objects etc,
so the M command <em>moves</em> the page out of the way,
and takes you back to the previous page.
Note, this command works just as well with files.

<P>
Suppose a web page presents
<P>
{planes}
<br>
{trains}
<br>
{automobiles}

<P>
If you are curious about all three topics,
issue these commands in this order.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>1g
M2
2g
M3
3g
M4
</font></PRE>

<P>
Now sessions 2 3 and 4 are the subpages about plains trains and automobiles respectively.
You can fill out forms or follow hyperlinks in any of them,
or stay in session 1 and do something else.

<P>
Edbrowse clobbers the destination session, unless there are edits that have not been written out to a file.
You can issue the M command without a destination if you are not sure which sessions are available.
Edbrowse will pick an empty session for you
and print something like "moved to session 15".

<H3> <A NAME=music> Background Music </A> </H3>

<P>
If you are trying to listen to a speech synthesizer,
the last thing you need is background music.
Instead of playing the song, I make it available to you through a hyperlink.
<P>
{Background Music}
<P>
This always appears at or near the top of the page.
Click on this link to hear the music.
It should play automatically if you have the proper plugins configured.
If there is no plugin for that particular file type, or if plugins are disabled,
then edbrowse will load the audio file into the current buffer.
You can download it to a file, or play it in some other fashion.
Try the play buffer `pb' command.
Normally pb uses the name of the file to infer the audio format.
If the filename ends in .wav, it's a wave file, and so on.
Failing this, edbrowse tries to infer the file type from the Content-Type attribute in the http headers.
If the filename is not particularly helpful,
and the http headers do not provide a known content type,
and you know the audio format, you can specify it by typing
pb.wav for a wave file, pb.mp3 for an mp3 file, and so on.
The config file (described below)
includes mime types and plugins,
which tell edbrowse how to play various audio files.
These must be set up, or the pb command won't work.
It will say something like,
"I don't know how to process an mp3 file".
This is consistent with other browsers, which use plugins to play multimedia files that are retrieved from the internet.

<H3> <A NAME=heading> Headings </A> </H3>

<P>
Some web pages are written with headings, from level 1 to level 6.
These headings are indicated by h1 through h6 respectively.
Just as braces indicate a hyperlink, h2 indicates a second level heading.
Thus h2 is not part of the text; it is a markup character.
You can jump to different headings using the familiar ed commands:
/h2 for the next level 2 heading, ?h1 for the previous level 1 heading, and /h\d for the next heading at any level.

<H3> <A NAME=input> Input Fields </A> </H3>

<P>
The input fields of an on-line form are indicated by angle brackets.
For example, a search engine might present the following form.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>Keywords: &lt;&gt;
Advanced parsing: &lt;-&gt;
Language: &lt;en&gt;
Search now: &lt;GO&gt;
Clear form: &lt;RESET&gt;
</font></PRE>

<P>
The first line in this sample form is a simple text field, which is initially empty.
You supply the keywords to search for.
Entering and editing input fields is discussed later.

<P>
The second line is a checkbox.
This field tells the search engine to use advanced boolean features,
such as this keyword and that, or this, but not that, etc.
The feature is disabled, indicated by -.
(Most people don't know how to use advanced search anyways.)
A + means the checkbox is on.

<P>
The third line determines the language of the keywords, English by default.
This isn't a free text field, you can't just type in anything you want.
It is a dropdown list of languages.
I'll describe how to view the options later.

<P>
The fourth line is the submit button, which sends the form to the search engine
and retrieves the results.
This field cannot be edited; it is merely a button to push.

<P>
The fifth line is also a button to push.
It clears all the data you have entered, so you can start over.
Default values will be restored.
Thus the third line goes back to &lt;en&gt;, rather than &lt;&gt;.

<H3> <A NAME=entry> Data Entry </A> </H3>

<P>
Filling out a form is relatively easy,
once you are familiar with the overloaded `i' command.
Yes, i by itself means insert text,
but in browse mode, i refers to the input fields.

<P>
If there is only one input field on the current line, i?
displays information about that input field.
If the line contains multiple input fields, you will need to use a number,
as in i3? for the third field.
The type of input field is displayed, then its size,
then the field name.
If the input field is drawn from a set of options,
the option list is displayed as well,
with menu numbers prepended.
When you want to select an option,
you can either type in a substring that determines that option uniquely,
such as mich for Michigan,
or you can type in its menu number.
Recall the sample form in the previous section.
If you type i? at the third field, you might see the following.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>select[7] language
1: english
2: french
3: german
4: italian
5: spanish
</font></PRE>

<P>
If a select list contains hundreds of options,
type i?string to see only those options that contain the specified string.
Type I?mi in a state field and get Michigan, Mississippi, Missouri, and Minnesota.
Then you can select the option you want by name or by number.

<P>
Now let's do some data entry.
Type i=xyz to place xyz in the input field.
Type i3=xyz
to put information into the third input field on the current line.
If you get an error, it is probably because the field has a fixed set of options,
and you didn't pick one of those options.
You can either type in one of the options or its menu number.
You can also type in a fragment of the option you want,
and edbrowse will fill in the rest.
This is done whenever one and only one option contains a copy
(case insensitive) of the string you entered.
Thus you could enter tali above and get Italian,
as that is the only language with those four letters.
This is useful when you are entering your address,
and they ask for the state.
Type in a few letters of your state name, enough to be unique,
and you'll probably glom onto the correct option in the list.
Note the paradigm here:
in a command line program,
you don't want to wade through a menu unless you absolutely have to.

<P>
There is some ambiguity when the option is itself a number.
In this case edbrowse performs three matches.
If you type in the number exactly as it appears, that option is selected.
If the number you entered is not a perfect match for one of the options, it is treated as a menu number.
If it is not a valid menu number (e.g. out of range),
edbrowse performs a partial match on the options, looking for those digits as a substring.
This may seem confusing, but it is usually what you want.

<P>
If you would like your password to not be displayed on screen when you type it,
you can use ipass (or ipass2 if the password is the second field) to get a no-echo
prompt for your password.
When printing anything you entered with ipass, or if the input field type is password,
you will get stars back, consistent with other browsers.
However, if you submit a form, and the debug level is 3 or higher, you will see the password in plain text as edbrowse prints the fields it is sending to the server.
Users rarely run in debug mode, so this is not an issue.

<P>
You can use i&lt;7 to pull the contents of session 7 into the current input field.
Session 7 must have one line of text only.
Similarly, i&lt;filename reads the contents of the file into the current input field.
Only the first line of text is read.
The filename is expanded in the usual way.
This includes wildcard expansion, as long as the expansion leads to one and only one file.
Put enough characters around the * to designate a single file.

<P>
Text areas are often used to capture a paragraph, i.e. a complex thought, but some websites expect you to compose your thought in a one-line input field.
In that case, switch to another session where you can use the power of the editor.
Compose your thought, type ,J to put it all on one line, switch back, and type i&lt;7 to pull it into the input field.

<P>
Suppose you are entering your credit card number, all 16 digits, into a free text field.
If you've made a typo, you don't really want to enter the entire string again.
No problem -- use the substitute command.
You can write this as i/x/y/ or s/x/y/ -- as you prefer.
Remember, you may need to specify a field, as in s3/x/y/.
The usual substitution syntax is honored.
Don't overgeneralize the g suffix.
s3/x/y/g changes every x to y in the third input field, but does not affect the other fields on the current line.

<P>
If the submit button is the third field on the current line, you can press it via i3*.
However, i* is sufficient when there is only one button on the line.
Similarly, you can establish a text field by entering i=kangaroo,
rather than i1=kangaroo, if the second field on the current line is a submit button.
You only need specify a field number
when there are multiple input fields, or multiple buttons, on the current line.

<H3> <A NAME=textarea> Text Areas </A> </H3>

<P>
Some internet forms allow you to type freely, as in "Please enter your comments here."
This is done inside a window within the screen,
having a fixed number of rows and columns,
although that is usually an artificial constraint.
The sighted user can type more lines than the window will hold,
and the window scrolls appropriately.
Fortunately the blind user can ignore the artificial window and type freely.
Still, the i? directive tells you how big the window would be
if you were running a visual browser.
You might see something like "area[7x40]", which indicates a window 7 rows by 40 columns.

<P>
The lynx implementation of the text area is somewhat restricted.
This is not surprising, since lynx is not an editor.
You can correct small typos on the current line,
but you can't actually edit the text you are working on.
Once you hit return, that line is done, and you're on to the next line.
You can't move lines around or insert lines,
nor can you prepare your comments ahead of time and read them into the text area from a file.
In edbrowse, the text area is managed from another editing session.
This allows you to use the full power of the editor.
You can move text, make global substitutions,
or read comments in from a prepared file.
The editing session is chosen for you, and appears in the input field.
Consider the following form.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>Enter your email address: &lt;&gt;
Enter your comments: &lt;buffer ?&gt;
</font></PRE>

<P>
If you wish to enter any comments, you must allocate the buffer using the ib command.
At this point &lt;buffer ?&gt; changes to &lt;buffer 2&gt; (or some such).
Session 2 was not active when browsing began, but it is now.
Type e2 to move to session 2, prepare your comments,
then type e1 to return to the input form.

<P>
On most web pages the text area starts out blank,
whence buffer 2 will be empty,
but this is not always the case.
Be sure to check for pre-existing text before you start typing your thoughts.
A particularly arrogant site might preload the text area with:
"I love your website because:".
Preset text is indicated by &lt;buffer text&gt; rather than &lt;buffer ?&gt;.

<P>
When you finally submit the form,
as discussed in the next section,
the text in buffer 2, associated with the second editing session,
will replace the words "bufffer 2" in the input field,
and your carefully crafted comments are on their way.

<H3> <A NAME=button> Push The Button </A> </H3>

<P>
If the third input field on the current line is a reset or submit button,
press the button via i3*.
The reset button puts the input fields back to their original values,
as supplied by the web page when it was first loaded.
The submit button sends the form to the remote server and waits for a response.
This is similar to following an internet link,
but in this case you are sending some data along with the request.
Type "kangaroo" into a search engine and you'll soon be reading a web page about kangaroos.
As with any other link, you can use the ^ key to go back.
In this case you will return to the on-line form.
You can change the data and submit the form again, asking about another animal.

<P>
Edbrowse supports the "get" and "post" methods,
the most common http protocols,
and they seem to work on most sites.

<P>
Once you have submitted your form
and you are viewing the results,
you may notice some strange characters at the end of the filename.
If you have retrieved information on kangaroos, the filename might look like:
www.search-engine.com?keywords=kangaroo.
The text after the question mark is an encoded version of the data
you entered into the form.
It becomes part of the virtual URL.
This only applies to the get method; the post method sends the data through another channel.

<P>
Remember that buttons can run javascript, without being type submit or reset.
These are all pressed by the i* command.
If more than one button is on the current line, any style of button, then i* is not sufficient; you have to specify which button, as in i3*.

<H3> <A NAME=hover> Hover Text </A> </H3>

<P>
Some websites cause text to appear when you hover over a link or icon; then it disappears when you move the mouse away.
Edbrowse has nothing analogous to a mouse hovering over an icon, so we had to think of something else.

<P>
Hover text is usually explanatory, and rarely essential.
Since the goal of edbrowse is minimal output, edbrowse does not display this text by default.
However, you can turn it on with the showall command.
All the hover text appears, all over the page.
It might be nice to hover over a particular line, but so far this has proved problematic.
It's not clear what if anything you can hover over, and the message might pop up on a different part of the screen, perhaps 20 lines down in the buffer.
For now, the approach is to reveal all hover text wherever it appears.
If you like, you can save the two buffers, and diff to read the lines that have changed.
You probably only need to do this once on a website that you will be visiting again and again.
Once you have read the hover explanations you probably won't need to read them in the future, whereupon you can run with showall disabled.

<P>
In rare cases, hovering over an icon reveals links or buttons.
Because they are active elements, these are shown all the time.
You need to know that these links or buttons are available.
In other words, edbrowse only hides hover text, not hover links.

<P>
Cascading style sheets (css) also injects text into the page, but this tends to be based on element type or class.
Put a star in front of every paragraph that has class=footnote.
Put a right arrow after every hyperlink with class=external, taking you to another website.
Put a green circle in front of every input field with class=required, a required field.
These little symbols are primarily visual, and of almost no value to edbrowse users.
Once again they are hidden by default.
They are not strictly hover text, but these are also revealed by the showall command.
As mentioned earlier,
the injected characters or emojis are helpful visual reminders of the nodes they adorn, and are rarely vital;
however, there are a few websites where the injected text is explanatory, and might be worth reading at least once.

<P>
Finally, the showall command shows the sections that are rendered invisible by css or javascript.
These are in quotes and braces, e.g. `{hello world}'.
These might be hidden because they are not relevant to you, or to your current situation.
Why show the checkout link if there is nothing in your shopping cart?
However, edbrowse javascript is still a work in progress, and sometimes a bug keeps a section invisible, when it should be shown.
Thus you might want to see what you are missing.

<P>
The showall command does not show or hide text unless javascript is enabled.
Without javascript, all the hover text and all the invisible sections are shown.

<H3> <A NAME=colors> Colors on the Page </A> </H3>

<P>
In an accessible world,
colors should not be semantically relevant; but sometimes they are.
You may have pushed submit on an entry form,
and received a message like:
Invalid entry, please review the fields marked in red.
How do you know which fields are red?
Enter the colors command to find out.
This is a toggle command, so colors+ and colors- will work.
Words, sentences, or entire sections will be surrounded by color indicators.
In this example, Brirthday is in red, because February doesn't have 29 days.
The rest of the input form is in black.
</p>

<P>
:blackFirst name &lt;Johhn&gt;
<br>
Last name &lt;Smith&gt;
<br>
:redBirthday &lt;02/29/1983&gt;
<br>
Submit &lt;send&gt;
</p>

<P>
Websites often specify colors using rgb values, which are almost useless to us.
Do you really know that #e8180f is red?
So edbrowse converts these values to the nearest standard color.
These color words are established by css convention, and are necessarily in English.
You might be using edbrowse in German, with messages translated accordingly, but a black section is denoted :black, not :schwartz.
</p>

<P>
The delimiters are nonascii mathematical operators similar to &lt;&lt; and &gt;&gt;.
So far these are the only nonascii symbols generated by edbrowse,
though we may use others in the future, for invisible sections, hover sections, frames, etc,
since we are badly overloading the ascii character set.
Also, you can configure your adapter to read these higher unicodes any way you like, for example,
"color start" and "color end".
</p>

<p>
Colors come from css, and css doesn't run without javascript, thus this feature only works with javascript enabled.
</p>
<H3> <A NAME=addr> Web And Email Addresses </A> </H3>

<P>
The capital A command shows you the web addresses behind
the links on the current line.
Each web address will be surrounded by &lt;a&gt; and &lt;/a&gt; tags,
ready to be pasted into a bookmark file, if that is what you wish.
These addresses exist in a new editing session; the previous session has been pushed onto the stack.
You can add these to your bookmark file via w+ $bookmarks,
assuming you have set the environment variable bookmarks appropriately.
They will be appended at the end;
you can move them to a more appropriate place in the file later on.
Finally, use the ^ key to return to the web page you were viewing.
Here is how it might look.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>&lt; b this.that.com/whatever  # browse a web page
&gt; 16834  # size of the raw html
&gt; 7855  # size of the browsable text
&lt; /kangaroo/i  # looking for kangaroo on the page
&gt; Click here for {more information about kangaroos}, or {send us mail}.
&lt; A  # capture the URLs
&gt; 144  # size of the URLs
&lt; ,p  # let's see them
&gt; &lt;br&gt;&lt;A HREF=www.kangaroo-info.com&gt;
&gt; more information about kangaroos
&gt;  &lt;/A&gt;
&gt; send us mail:info@kangaroo.org
&lt; 4d  # don't need the email address
&lt; w+ $bookmarks  # append this url to the bookmark file
&gt; 336
&lt; ^  # back to browsing
&gt; Click here for {more information about kangaroos}, or {send us mail}.
</font></PRE>

<P>
I suppose I could interrogate the environment variable $bookmarks myself
and append the URL to that file automatically,
but as this example shows, you might not want all the links.
In fact the email link makes no sense in a bookmark file.
Also, you may want to change the description of the link,
though in this example the description is pretty reasonable.

<P>
Alternatively, you might discard the url and retain the email address,
appending it to your address book.
Again, you will want to change the generic phrase "send us mail"
to a brief string that is meaningful to you, such as kangaroo-mail.
This becomes the alias, which you can use to send mail
to that recipient.
Subsequent sections will describe the use of edbrowse as a mail client.

<P>
If there are no links on the current line, or you are not in browse mode,
the current filename is used.
This is useful when you want to bookmark the current page,
rather than some other page pointed to by a link.

<P>
If the current page is the result of a form submission, the filename
may include your input fields after the question mark.
If it does, that's a feature, not a bug.
This exact URL, with the data at the end, can be stored as a bookmark
and activated again and again,
as though you had filled out the form each time.
Every week you can call up this virtual URL
to see if there is any new information on kangaroos.
A more practical example might be a canned query that retrieves
the weather for a certain city
or the stock prices for the companies in your portfolio.
You can also write concise scripts that fill in the virtual
form, simply by modifying the information after the question mark.
This provides a simple command to retrieve the weather from any major city
or the current price of any stock.

<P>
Under the A command,
the text of the newly created hyperlink is the title of the current page.
If there is no title, the text of the link is drawn from the url,
which is definitely suboptimal.
In that case you might want to change the text of the link.
fortunately, most internet pages have a title.

<P>
One last warning about adding links to your bookmark file.
Let's say you've issued the A command, and tweaked the description just a bit.
Now the link is just write, and you want to save it.
You accidentally type `w $bookmarks', forgetting the plus.
Instead of appending the link to the end, you have clobbered your entire bookmark file.
Years of accumulated links are gone.
To avoid this disastrous typo, create a macro to append to your bookmark file.
I know, we haven't talked about user defined macros yet, but we will.
And when we do, you should write a "bookmark append" macro that looks like this.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>function+bma {
  w+ $bookmarks
}
</font></PRE>

<P>
Now you can type &lt;bma to add a link to your favorites,
and you don't have to worry about typos.
It's shorter than `w+ $bookmarks' anyways.

<H3> <A NAME=cook> Cookies </A> </H3>

Most websites serve cookies,
which your browser is expected to retain
and pass back during subsequent exchanges.
In fact many websites simply won't work without cookie support.
Therefore edbrowse always accepts cookies.

<P>
Persistent cookies are stored in a file,
specified as `jar = file' in .ebrc,
and are thus available for subsequent edbrowse sessions.
These cookies are used to store long-term information about you,
such as your login and password into amazon.com.
Hence your cookie file should be mode 0600.
In fact it is created mode 0600 if it does not exist.

<P>
You probably won't need to view your cookie file, ever,
but it is text based, and can be edited directly if you wish.
Don't edit it when any web pages are active, or you may run into race conditions.

<P>
speaking of race conditions, don't surf the net using separate instances of edbrowse running in different virtual consoles.
Instead, run one instance of edbrowse with different web pages in different buffers.
Parallel edbrowse programs could each write out the cookie file independently,
and the second could conceivably clobber some cookies that were set by the first.
It's only a minor nuisance, and you might not even notice.
Still, a future version of edbrowse might use one global http server to get around this problem.

<H3> <A NAME=ssl> Secure Connections </A> </H3>

<P>
Edbrowse supports the most common method of encrypting web traffic,
HTTP over SSL/TLS, colloquially known as secure http.
Websites that support
secure http have URLs of the form:
https://secure.server.com.
Notice the protocol is https:// rather than http://.
The extra s stands for "secure".
The traffic is encrypted, i.e. mathematically scrambled,
and cannot be intercepted by a nefarious third party.

<P>
Edbrowse will verify ssl connections,
based on a file of certificates provided by the system.
This is an antispoofing measure, to make sure a hacker isn't posing as your bank,
trying to steal your account numbers and passwords.
You can provide your own file of certificates, or point to a different file, using the certfile directive, but this is not recommended.
The system file is probably your best bet.
In general it's a good idea to verify secure connections,
unless it prevents you from getting to a website whose authenticity you accept at face value.
In that case you can use the vs command to turn the feature off.
This is a toggle command; type vs again to turn the feature on.
For another method of disabling verification on a site-by-site basis,
see the novs directive in the configuration file section below.

<P>
Never send sensitive information,
such as social security numbers or credit card numbers,
over an insecure channel.
Make sure the form is using ssl.
How can you tell?
The submit button will have the word "secure" added to its text.
<P>
&lt;Make your purchase now secure&gt;
<P>
This is similar to the lock icon that Explorer uses to tell you that your connection is secure,
although edbrowse is not quite as foolproof.
A website could fake you out by putting the word secure in the submit text.

<P>
Note that generic buttons, besides the submit button, can also submit your form
through javascript.
I don't know if that button is going to submit the form or not,
and I don't want to put the word "secure" on every button on the page.
I only add it to the submit button,
but if that button is secure then the others are probably secure too.

<P>
If you have logins on secure servers,
such as PayPal.com,
you must keep your password absolutely safe.
Never send that password over an insecure connection.
It becomes as valuable as your credit card numbers.
Use a special password for your secure logins,
and only for those logins.
Use other, expendable passwords when the connection is not secure.

<P>
Please don't fall for all those phishing email scams
that tell you your login has expired, and would you please log in again using this convenient form.
The mail is forged to look legitimate,
and the form actually sends your secret password to a thief
who then raids your account.
A reputable company will
never ask you to login through an email form.
They will always tell you to go back to the website and log in there.

<P>
Internet security is complex, to say the least,
and it is beyond the scope of this document.
As a general rule,
secure http is really quite safe, and you can use it to send sensitive information across the Net.
It's probably safer than giving your credit card number to the clerk on the phone,
who use to take your order before there was e-commerce.
so it's ok to be a little bit paranoid,
in fact it's probably a good idea,
but don't let that stop you from making your online purchases.

<H3> <A NAME=ftp> FTP Retrievals </A> </H3>

<P>
This browser supports the retrieval of ftp files and directories.
You can provide an FTP URL like:
ftp://ftp.random.com/tarball.tar.gz
and the file will be fetched.
It doesn't matter whether you type in the url yourself,
or it is a hyperlink on a web page.
The file is retrieved, and placed in a new buffer.
Type w/ to save it locally, which is what a traditional ftp client would do.
Of course the download could fail, in which case you will receive an error message.
If it was interrupted
due to some internet glitch,
you can always issue the command again and hope for better luck.

<P>
By default, edbrowse uses the account name "anonymous" and the password
"ftp@example.com" for ftp connections.
However, you can override this in the url,
and some web pages take advantage of this feature.
For example, let's say you want to access the file /opt/foobar on whatever.localdomain.
This file isn't readable by anonymous users.
You have to log in as a real person.
Within edbrowse, you might use the command:
<P>
e ftp://chris:xxx@whatever.localdomain/opt/foobar

<P>
The ftp connection will be made as user "Chris", with password "XXX".

<P>
Some ftp URLs point at directories, not files.  If you visit one of these,
and it is located on a Unix-like server, you will receive the listing as an
html file with hyperlinks.  You can visit the directory members just as
though you were exploring a website.
If the server does not run some
flavour of Unix, you will receive the directory listing in plain
text.

<P>
The ftp mode, i.e. the style of data connection,
can be either active or passive.
One works well when the client is behind a router,
and the other works well when the server is behind a router.
You can specify ftp mode active by entering the command `ftpa+',
or ftp mode passive by `ftpa-'.

<H3> <A NAME=gopher> Gopher Support </A> </H3>

<P>
Gopher is similar to ftp, providing an easy way to download files from a public site.
Edbrowse supports this via the gopher:// protocol.
Once again, directory listings are converted into html, so you can activate a hyperlink and procede to a submenu or download a file.

<H3> <A NAME=proxy> Proxy Servers </A> </H3>

<P>
A proxy server is a web server that sits between your web browser and remote websites.
It intercepts your requests for web pages and forwards them to the system that hosts
the site you are browsing.
Proxy servers are used for a variety of reasons.
Here are just a few of them:

<OL>
<LI><P>Efficiency.
The proxy server may be able to store previously-accessed webpages
(known as caching).
If your connection to the proxy is faster than your connection to the rest of the Internet,
then caching insures that frequently-accessed web pages load quickly.
<LI><P>Policies.
Some firewall administrators require their users to use
a proxy server.
<LI><P>Anonymity.
There are so-called anonymizing
proxy servers that hide your IP address from the websites that you browse.
</OL>

<P>
If you wish to use a proxy server for http traffic, simply set the proxy
option in your configuration file.
Provide the proxy's hostname and port, separated by a colon.
For example:
<P>
proxy = http * proxy.campus.edu:3128

<p>
All http traffic, for any domain (indicated by *), is routed through proxy.campus.edu on port 3128.
Note that proxies often listen on ports other than port 80.
Squid is a proxy server that comes bundled with some Linux distributions, and it uses
port 3128 by default.

<p>
Protocol and domain can be specified, or either can be replaced with a * for any protocol or any domain.
A missing domain is treated as a * (all domains),
and a missing protocol and domain matches everything.
Such an entry should be last in the list of proxies in your config file,
since proxies beyond this point have no meaning.

<P>
The word DIRECT in the third position is a direct connection, with no proxy server.
These are usually placed at the top of the list, to access certain internal domains;
then the proxy server is specified for all others.

<P>
proxy = http|https hr.mycompany.com DIRECT
<br>
proxy = http|https|ftp * proxy.mycompany.com

<P>
As shown in this example, different protocols can be separated by pipes.
Beware, placing a * in the protocol field embraces all protocols, including ftp, pop3, and smtp.
Mail will attempt to pass through this proxy, just like web traffic.

<H3> <A NAME=frame> Frames </A> </H3>

<P>
Frames are a mechanism whereby a web page can fetch and display several other web pages on the screen at once.
Each subpage is called a frame, and lives in its own space on the screen.
Sometimes the frames are top middle and bottom;
sometimes they are left middle and right.
Edbrowse presents these frames as hyperlinks,
and you can expand each in turn
using the `exp' command,
or expand them all if you wish.
Type 1,$exp to expand them all, or equivalently, ,exp.
The ctr (contract) command hides the frame and makes it a hyperlink again.
Type ,ctr to contract them all.
Sometimes you can leave a frame closed if you have been to this website before and you know that information does not interest you.
On rare occasions, and I've only seen this once,
you must open the top frame,
whether you are interested in it or not,
because that particular html page sets some cookies that you need to run the website.

<P>
Here is a page of frames, and then the same page after the middle frame is expanded.

<P>
Frame {navigation}
<br>
Frame {main}
<br>
Frame {bottom}

<P>
Frame {navigation}
<br>
`--
<br>
This is the home page of blah blah blah.
Interesting information about blah blah blah.
We've got the lowest prices anywhere.
<br>
--`
<br>
Frame {bottom}

<hr>
<H2> Chapter 5, Javascript </H2>

<H3> <A NAME=js> Introduction to Javascript </A> </H3>

Javascript is software, embedded in the web page, that runs on your computer.
These functions do not run on the web server,
they run right on your box.
Hence it is sometimes called client side javascript.
And javascript can do almost anything.
You could, for instance, download a web page that includes a javascript function to compute the digits of pi,
right on your computer,
although that would be rather silly.
Most of the time javascript is used to validate and/or modify forms
or create fancy visual effects.

<P>
The first version of edbrowse, written in perl, ignored javascript completely,
and that was ok for a while,
but more and more sites use javascript,
and these websites were simply inaccessible.
Most of the e-commerce sites fall into this category.
If you want to make purchases, or manage your bank account online,
you need a javascript enabled browser.

<P>
The second version of edbrowse, written in C,
and indicated by a version number that starts with 2,
included a home grown javascript compiler and engine
that I wrote myself.
This worked pretty well, for a spare time project,
but javascript evolves, like any other language or standard,
and I just couldn't keep up.

<P>
The third version uses an open source javascript engine, originally Mozilla js, and now, as of version 3.7.0, Duktape js.
This allows me to leverage, rather than reinvent, some 70,000 lines of code -
and somebody else is maintaining that code as javascript evolves.

<P>
Edbrowse does not support all the features of client side DOM javascript,
and it probably never will.
For example, many websites use javascript to change images
on the fly as you move your mouse around the screen.
This has no meaning in edbrowse.
Other websites bring up multiple windows,
and let you control the contents of subwindows using icons in a master window.
This would be difficult to simulate in a command-line environment, though perhaps not impossible.

<P>
Some javascript is implemented, some is not.
This is still a work in progress.
If you submit a form, or go to a hyperlink, and nothing happens, absolutely nothing,
then the web page is probably trying to use javascript features that are not yet implemented.
Raise the debug level to 3 or higher and push the button again to see the javascript errors.
Then, if you wish, disable javascript with the js command and try again.
However, the website may not behave properly or as expected with javascript disabled.
See the disclaimer at the top of this users guide.

<P>
You can also disable javascript for specific domains.
This will be discussed later in the edbrowse config file.

<P>
If a page is slow to browse, it may be running a lot of javascript, or it could be fetching files from the internet.
In either case, you can interrupt the process by hitting control C.
Javascript stops at a breakpoint, if it can, and the page browses with the information it has at hand.
This is fine if you're just reading a newspaper article and you don't want to wait for all the advertising to come into place,
but you should never do this on an e-commerce site, or a banking site, or a site whose operation is mission critical.
If the javascript does not run to completion, we cannot guarantee the proper operation of that website.
You might wind up ordering a $37,000 elephant instead of
$37 worth of printer supplies.

<P>
If you have been hitting control C for 45 seconds with no reaction,
edbrowse forcibly interrupts the running javascript and issues this message.
<P>
No reaction for 45 seconds, operations aborted, results are unpredictable!
<P>
This is drastic, but some websites fall into an infinite loop, and this is better than being locked out of edbrowse forever.
Javascript is disabled at this point.
You can turn it back on - at your own risk.
The javascript engine was interrupted in mid operation, and it's behavior is unpredictable if it starts executing somewhere else.
However, I have tried it a few times and it seems to work.
</p>

<H3> <A NAME=valid> Validating Forms </A> </H3>

When a web page asks for user input,
it often includes a
"validate&amp;submit" function.
This function checks your entries:
have you filled in all the required fields -
is there an @ sign in your email address -
are there 5 digits in your zip code -
and so on.
If there are no errors, it submits the form.
These functions usually behave well under edbrowse.
When you push the button, you will either see the error message,
or the form will be submitted,
and a confirmation page should appear shortly.

<P>
In some cases the javascript function
reformats your data.
It may fill in some of the hidden fields for you,
or it may compute sales tax and adjust the purchase price accordingly.
This is more than form validation, this is active javascript,
and the data won't be right unless the javascript runs properly
on your computer.
More and more sites are using active javascript,
so a javascript enabled browser is a must.

<P>
Some javascript functions manage menus dynamically.
Make a primary selection,
and javascript populates a second dropdown list with options
corresponding to your first selection.
You can now make a second selection,
which further refines your search.
If the first menu presents "meats", "vegetables", "fruits", and "grains",
and you select fruits,
the second menu might contain
"apples", "oranges", "lemons", etc.
Javascript makes this possible.
These dynamic menus are supported by edbrowse.
You will see a message like, "Line 352 has been updated",
where 352 contains the submenu.
Type 352I? to see the newly created menu options.

<H3> <A NAME=popup> Popups and Popunders </A> </H3>

A popup is a window that suddenly appears in front of the window you really want to see.
It usually advertises something, and is often annoying,
although in rare cases it is a necessary aspect of the website.

<P>
You have a distinct advantage over all those other surfers with their graphical browsers.
The popup window does not open automatically.
Instead, the popup appears as a hyperlink at or near the top of the page,
and you can click on it if you like, or ignore it.
This is similar to the <A HREF=#music>background music</A>, described in an earlier section.
The popup link might look like this.
<P>
redirect: {Spring specials}

<P>
Popunders are not as common.
They appear after you have closed the window.
In some sense they are hidden "under" your web page, and when you close the page they pop out.
In edbrowse, this does not happen automatically.
When you type q, you quit, and that's the end of it.
As you might expect, the popunder function appears as a hyperlink.
It might look like this.
<P>
Onclose {Body}

<P>
Remember, the popup link is a simple html link to another web page,
while the Close link calls a javascript function on the current page.
However, this javascript function usually links to another web page,
so don't be surprised if you find yourself somewhere else on the internet.
In either case, popup or popunder, you can use the back key to return to the
page you were looking at.
If you need access to a popup window and the main page in parallel,
use the <A HREF=#move>M command</A>.

<H3> <A NAME=onc> Onchange and Undo </A> </H3>

When you set or change the value of an input field,
the form can optionally call a javascript routine.
It doesn't usually, but it can.
An earlier example describes a primary and secondary menu.
When the first selection is made,
e.g. fruits,
javascript sets up the second menu commensurate with your primary selection
using the onchange feature.
This is all well and good,
but edbrowse has something
your graphical browser does not, the undo command.
And in this context, it doesn't really work.
Change fruits to vegetables, and the second menu presents carrots and peas and the like.
Now type u for undo,
and the first field reverts back to fruits,
but the second menu still contains vegetables.
This is because the undo feature was originally written for the text editor.
It simply puts the text back the way it was, and has no capacity to "undo" the side effects of javascript code.
To this end, the undo command is disabled in browse mode.
You're just fiddling with small input fields - the undo command is probably not necessary.
If, however, you are formulating a text response in a textarea, that is done in another buffer,
and you have the full power of the editor, including the undo command.

<H3> <A NAME=jex> Javascript Debugger </A> </H3>

<P>
In browse mode, the jdb (javascript debug) command
directs subsequent input to the javascript engine containing the objects associated with the current web page,
specifically, the frame associated with the current line number.
Type period by itself, or bye, to return to edbrowse.
It is best to enter jdb with debug level 3, so you can see any javascript syntax or reference errors.
This feature is for developers, and is not very helpful for end users.

<P>
If the output of any command is long, you can redirect it into a file by using the ^&gt symbol, as in expression ^&gt; file.
I didn't want to use &gt; since that is a valid javascript operator.
A predefined ok (object keys) command lists all the members of an object.
showscripts() shows you the scripts in the current document, even generated scripts.
These will be left in $ss.
Type dumptree(document) to see the structure of the document.
Use aloop(0,5,expression) to evaluate the expression as i runs from 0 to 4.
Use aloop(y,expression) to run over the length of the array y.

<P>
A few edbrowse commands are valid inside the javascript debugger.
These are: the db commands (to change debugging), e number (to jump to another edbrowse session and look at another file),
bflist, bglist, timers, demin, and shell escapes.

<hr>
<H2> Chapter 6, Edbrowse Scripts and the Configuration File </H2>

<H3> <A NAME=cfg> Config File </A> </H3>

<P>
At startup, edbrowse reads and parses a config file.
It's ok if this file is missing, but if it is present
it should be syntactically correct.
If there is an error, edit the config file, fix the error, and type `config' to reapply.
Repeat until there are no errors.
Processing of the config file stops at the first error, so you really want a clean run.
Remember that `edbrowse -c', from the command line, will edit the config file directly.
Also, from within edbrowse, a file name of -c is treated as the config file.
You can switch to a new session, view, edit, save, and reaply the config file without ever leaving edbrowse.


<P>
The config file is in $HOME/.ebrc.
The "eb" is shorthand for edbrowse.
You cannot rename the config file; it is what it is.
The location in Windows is different, but still based on $HOME.

<P>
The config file is line oriented.
Lines beginning with # are comments, and are ignored.
Blank lines are also ignored.
All other lines fall into one of 7 categories.

<OL>
<LI><P> Define an option using the keyword=value syntax.
<LI><P> Define an edbrowse script that can be invoked from the command line
or from another script.
<LI><P> An edbrowse command, that becomes part of an edbrowse script.
<LI><P> Establish an email account.
This will be described later, under email clients.
<LI><P> A mail filtering rule.
<LI><P> Describe a plugin.
<LI><P> Describe a table or a view in an sql database.
</OL>

<H3> <A NAME=keyval> Keyword = Value </A> </H3>

The best documentation is an example, so let's dive right in.

<P>
Recall the section on <A HREF=#cook>cookies</A>.
You'll need a file, often called a cookie jar,
to store your cookies.
The line that establishes this cookie jar might look like this.
<P>
jar = /home/mylogin/.ebsys/cookie-jar

<P>
This is a simple keyword = value syntax.
It's ok if the filename has embedded spaces, or even an equals sign.
No need to quote it.

<P>
When edbrowse sees this line in its config file, it records the location of the cookie jar,
and it checks the validity of that file.
If the file is a directory (or something weird),
or is otherwise inaccessible,
edbrowse prints an error message and stops processing the config file at that point.
If this happens,
edit your config file
and change the cookie jar.

<P>
Here are some additional name=value directives.
Some of these are used to set up an email account.
This will become clearer when we talk about the mail client.

<P>
certfile = /etc/pki/tls/cert.pem

<P>
Specify the file that holds the certificates for secure connections.
This was explained in the section on <A HREF=#ssl>secure connections</A>.
This can usually be omitted, whereupon edbrowse uses the system's certificate file.

<P>
maildir = /home/mylogin/mbox
<P>
Go to this directory when fetching mail.
thus, if you save a mail message, you'll always know where it is.

<P>
cachedir = /home/mylogin/.ebcache
<br>
cachesize = 200
<P>
Edbrowse stores some web pages locally, in a cache, so that they can be fetched directly from your computer when you visit them again.
(All modern browsers do this.)
You can specify the cache directory where these files are stored.
If omited, edbrowse selects ~/.ebcache on Unix, or a directory in your temp area on Windows.
On a multiuser system, your cache should be private, since it literally contains the web pages you are looking at.
Separate users should not share the same cache space.
The cache directory is created mode 0700, if it does not already exist.

<P>
The cachesize parameter sets the size of the cache in megabytes.
Default is 1000.
If this is set to 0, edbrowse does not cache any files.
When the cache is full, edbrowse deletes the 100 oldest files and marches on.
Edbrowse does not retain more than 10,000 files, even if the cache could hold more.

<P>
webtimer = 30
<br>
mailtimer = 180

<P>
Wait 30 seconds for a response from a web server, and 3 minutes for a response from the mail server.
A time value of 0 waits forever.
Sorry, there seems to be no way to interrupt a socket call,
other than control backslash (quit), which kills the entire program.
That's why these timers are here - so you don't hang forever.
The defaults are 20 and 0 respectively.

<P>
downdir = /home/mylogin/downloads

<P>
When you access a binary file on a website, you have the option of downloading it directly to disk,
rather than reading it into memory.
If you do this, the file is placed in this download directory by default.
If the file name you entered has a slash, or if there is no download directory,
the path is taken relative to the current directory (assuming it is not absolute).
In this case, globbing is performed.
For instance, you can direct an mp3 file to ~/music/country/Some-Song.mp3.
Downloads take place in the foreground, with progress dots, thus locking up edbrowse until the download is complete.
If you prefer, you can run downloads in the background by issuing the bg (background) command.
This is especially useful for large files.
You are notified when the download is complete.
Meantime you can continue to use edbrowse.
No dots will be printed, as they would interfere with what you are doing.

<P>
When prompted for the filename, hit return for the default file name
as provided by the website,
enter x to abort,
enter space to read the data into memory,
or type a different file name if you wish.
If the file already exists, it is overwritten.

<P>
Type bglist to list your background download jobs, including those that have run to completion.
Upon exit, edbrowse will list any background downloads that are in progress.
These continue to run, even after edbrowse exits,
and they will print "download complete" messages when they finish.

<P>
Foreground downloads, or any internet fetch for that matter, prints progress dots,
but you can suppress these with the pdq (progress of download quiet) command.
Another option is the pdc (progress of download by count) command.
This prints megabytes downloaded and megabytes total.
For instance, 17/235 means 17 megs received out of 235.
These are decimal megabytes, not binary 0x100000 megabytes -
there is only a slight difference.

<P>
nojs = space.com
<P>
Specify domains that don't need javascript.
You can eliminate annoying error messages and speed up access
by disabling javascript for certain websites.
Javascript will not be run on pages within these domains,
nor will it be fetched from these domains.
The above directive will also drop javascript from subdomains such as www.space.com.

<P>
You can include a path or partial path after the domain, as in space.com/popups.
This will block the popup ads that you don't want to see, which often generate edbrowse errors in any case.
Subdomains are not considered when a path is given; the domain must match exactly.

<P>
novs = example.com
<P>
Indicate hostnames for which SSL certificate verification should not
be performed.
This directive is useful for sites that use self-signed certificates,
since these cannot be verified.
It should probably not be used for anything serious, such as a site that
is going to receive your credit card number.
This directive includes subdomains, such as www.example.com.
<P>
inserver = pop3.some-domain.com
<br>
inport = 110
<br>
outserver = smtp.some-domain.com
<br>
outport = 25
<P>
Specify the machines and ports that you use to fetch mail and send mail respectively.
You can use the fully qualified domain names, or aliases as defined in /etc/hosts.
The ports shown here are standard, and usually correct.
They are also default in edbrowse, so you need not set inport and outport unless they are different from that shown above.
Note, these keywords are only valid in the context of a mail account, as indicated by mail{}.

<P>
A star in front of the port number,
e.g. outport *465,
means the socket is to be encrypted for security.
When the smtp port is encrypted, login authentication is assumed.
No other authentication method is implemented at this time.

<P>
An arrow in front of the port number,
e.g. outport ^587,
encrypts the socket, but only after an initial handshake in the clear.
This is the hotmail protocol, and it is as secure as *465; just different.

<P>
Use +587 to authenticate yourself without encryption.
This is sometimes done when you are directly connected to the mail server
and traffic is not flowing across the internet,
but the server still wants to make sure you are you.

<P>
secure

<P>
Incoming and outgoing email connections are secure.
This effectively puts stars in front of the port numbers, if ports are specified.
If ports are not specified, the defaults change to reflect the secure connections.
Default pop3s is 995 and default smtps is 465.

<P>
nofetch
<P>
Do not fetch mail from this account through the -f option.

<P>
login = eklhad
<br>
password = secret
<P>
Specify the login and password that edbrowse uses to fetch your mail.

<P>
from = Full Name
<br>
reply = john.smith@some-domain.com
<P>
These lines are added in to the emails that you send.
They tell the recipient who you are, and how to reply.
It is
<A HREF=http://www.spamlaws.com>
illegal</A> to use these lines for deceptive purposes.
Make sure they identify you, and that the reply address is indeed one of your email accounts.

<P>
adbook = /home/mylogin/.ebsys/address-book
<P>
When specifying recipients, you can use aliases instead of full email addresses.
Aliases are checked against your address book,
a line oriented text file that is specified here.
If your address book contains the line
<P>
fred : fred.flintstone@bedrock.us : 226 cobblestone way : 5553827
<P>
then you can use the alias fred,
and edbrowse will substitute Fred's email address when sending mail.
Only the first two fields in the address book are significant
as far as edbrowse is concerned.
Other fields might hold phone/fax numbers, street address, anything you like.

<H3> <A NAME=agent> User Agent </A> </H3>

Every time you fetch a web page from the internet,
your browser identifies itself to the host.
This is done automatically.
Edbrowse identifies itself as "edbrowse/3.5.1",
where the number after the slash indicates the current version of edbrowse.

<P>
All well and good, but some websites have no respect for edbrowse,
and no concern for Internet accessibility.
They won't even let you in the door unless you look like Explorer or Netscape or one of the major players.
StartPage.com,
a front end to Google,
is one example.
So what do we do?
We lie of course.

<P>
agent = Lynx/2.8.4rel.1 libwww-FM/2.14
<br>
agent = Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)

<P>
You can specify different agents in your .ebrc file,
and activate them with the `ua' (user agent) command.
If the previous lines are in your .ebrc file,
you can type ua1 to pretend to bee lynx,
or ua2 to pretend to be Mozilla.
Type ua0 to resurrect the standard edbrowse identification.

<P>
agentsite = google.com 2

<P>
Pretend to be user agent 2, that is, Internet Explorer version 7,
when talking to google.com or any of its subdomains.
I chose this example because it became necessary as of 05/25/2019.
google.com will not present the h3 headings on the search results unless you look like Internet Explorer.
I don't know why, I'm just trying to go with the flow.
Other sites are also particular about the type of browser, and none of them are looking for edbrowse.

<H3> <A NAME=script> Edbrowse Functions </A> </H3>

You can bundle a set of edbrowse commands together under one name,
similar to a macro.
If the following appears in your .ebrc file,
you can type &lt;ud to undos a file.
<P>
function:ud {
<br>
&nbsp;&nbsp;,s/\r$//
<br>
}

<P>
The new &lt; command is suppose to remind you of redirection,
i.e. read input commands from this macro.
And macros can invoke other macros
by using a &lt; command in the body.
Almost any edbrowse command is fair game.
A macro can fetch web pages from the internet,
fill out forms, submit requests, and send mail.

<P>
Unlike many things in the Unix world, macro names are case-insensitive.
Thus: dostuff, DoStuff, doStuff, ad nauseum, are all equivalent.
Also, if you define a macro with the same name multiple times,
the first definition wins.
Edbrowse silently ignores subsequent definitions.

<P>
Normally, edbrowse marches along, whether a command succeeds or not.
However, you can tell a macro to stop if it encounters an error
by using this syntax.
<P>
function+hw {
<br>
&nbsp;&nbsp;/hello/p
<br>
&nbsp;&nbsp;/world/p
<br>
}

<P>
The plus sign after the word function means each command in that function must succeed.
If there is no line containing the word hello, the function stops.
If there is such a line, then the function moves on,
and looks for a line containing the word world.

<P>
Other than some indenting, the format is fixed and unforgiving.
You cannot, for instance, put the opening brace on its own line, as K&amp;R would suggest.

<P>
These functions, or macros, can accept parameters.
Let's make the previous function a bit more general.
<P>
function+hw {
<br>
&nbsp;&nbsp;/~1/p
<br>
&nbsp;&nbsp;/~2/p
<br>
}

<P>
Reproduce the earlier behavior by typing &lt;hw hello world,
or search for different lines by invoking &lt;hw foo bar.
The latter looks for a line containing foo and prints it,
and if this succeeds it looks for a line containing bar and prints that.
Now let's build a more useful function, a shortcut to google search.
The variable ~0 represents all the arguments together.
In this case ~0 is the keywords you pass to google for your search.
<P>
function+gg {
<br>
&nbsp;&nbsp;b http://www.google.com
<br>
&nbsp;&nbsp;/<>/ i=~0
<br>
&nbsp;&nbsp;/</ i1*
<br>
&nbsp;&nbsp;/h3/p
<br>
#  Search results by h3 heading only works if google recognizes your browser,
<br>
#  so you need to spoof user agent to IE7. Use agentsite to do this.
<br>
}

<P>
With this in place, you simply type `&lt;gg kangaroo habitat'
to find out where kangaroos live.

<P>
Finally, an edbrowse function can branch,
based upon the success or failure of the previous command.
Use if(*) for success, and if(?) for failure.
The ? is suppose to remind you of the question mark that you get when an edbrowse command fails.
The following looks for a line containing foo, and if it finds one,
it advances to the next line, and if that line contains bar, it deletes it.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>function+silly {
  /foo/
  if(*) {
    +s/bar//
    if(*) {
      d
    }
  }
}
</font></PRE>

<P>
I deliberately used function+ instead of function: in the above example.
Normally the + will cause the function to abort if an edbrowse command fails.
However, if the result of that command is used by a control statement,
the function does not abort.
This is similar to set -e in the shell,
which causes the script to abort after a failed command,
unless the result of the command is used by an if or while statement.

<P>
Other control statements include while(*) while(?) until(*) and until(?).
The following deletes lines from the top of the file,
as long as they contain foo or bar.
It then deletes the blank lines at the top.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>function+topclean {
  until(?) {
    1g/foo\|bar/d
  }
  until(?) {
    1g/^$/d
  }
}
</font></PRE>

<P>
You can use loop(100){ ... } to repeat a set of commands 100 times.
This feature is not used very often.

<H3> <A NAME=init> The Init Script </A> </H3>

The script named "init" is run at edbrowse startup.
Use this to establish your default settings - even read in your bookmark file,
so your favorites are close at hand.
Here is an example.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>function+init {
#  turn debug off, so we don't see any status messages from this script
db0
#  Assume directories can be modified
dw
#  Put beginning and end markers around listed lines
endm+
#  Use readline for input
rl+
#  Let session 99 hold your favorites, ready to surf.
e99
b $bookmarks
#  back to session 1, ready to go to work
e1
#  Restore debug level to something reasonable, 1 or 2
db1
}
</font></PRE>

<P>
This is just a sample.
Put anything you like in your init script,
or leave it out altogether if you are happy with edbrowse out of the box.

<H3> <A NAME=ma> Mail Accounts </A> </H3>

The next chapter describes edbrowse as a mail client,
so let's use the config file to define some email accounts.
You can define several accounts as necessary.
They are implicitly numbered
in the order they appear in the config file.
The first mail account becomes #1, the second becomes #2, and so on.

<P>
We already discussed the relevant keywords for an email account.
All you have to do is enclose them in mail{...}, like this.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>mail {
  default
  inserver = pop3.some-domain.com
  outserver = smtp.some-domain.com
  login = eklhad
  password = secret
  from = Full Name
  reply = john.smith@some-domain.com
}
</font></PRE>

<P>
The "default" directive makes this account the default.
One and only one account should be labeled default.
If you do not specify an account when fetching or sending mail, the default account is used.
Beyond this, the default smtp server is always used to send mail,
no matter which account you specify.
If account #1 is default, and you send mail using account #3,
the name and reply address from account #3 will be sent to the recipient,
and if he replies, his reply will be sent to your third email account.
However, the smtp server from your default account is used to physically transmit the message.
There are technical reasons for doing this
having to do with security.
However, if an account has its sendmail stream encrypted, then security is not an issue,
and we can use these settings to send and receive mail.
Here is a typical configuration for Google's gmail.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>mail {
  inserver = pop.gmail.com
  outserver = smtp.gmail.com
  secure
#  Google also supports outport = ^587
  login = somebody@gmail.com
  password = secret
  reply = somebody@gmail.com
  from = Full Name
}
</font></PRE>

<P>
Mail filtering, by sender and/or subject,
is controlled by your config file as well.
This will be <A HREF=#filter>described later</A>,
as part of the fetchmail client.

<H3> <A NAME=mt> Plugin Descriptors </A> </H3>

<P>
Plugins are determined by the extension of the file, or in some cases the protocol.
They might tell edbrowse to use /usr/bin/play to play file.wav or file.voc,
and /usr/bin/mpg123 to play file.mp3, and so on.
Rather than repeat it all here,
you may want to look at the plugin {...} sections in the sample config file provided with this package.
Linux users can probably copy this part directly into their own config file.
It generally does the right thing.
Here is one example.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>plugin {
type = audio/mp3
desc = audio file in mp3 format
suffix = mp3
content = audio/mpeg
#  %i is replaced with the mp3 file or the mp3 url
program = mpg123 -q -C %i
}
</font></PRE>

<P>
This example handles an mp3 file or an mp3 stream.
That works because mpg123 will play a local file or an mp3 stream from the internet.
If mpg123 was limited to loca files on your computer, we would have to add the keyword down_url, whereupon a url is downloaded to a temp file and then played.
The autoplay feature can be disabled with the pg command that turns plugins on and off.

<P>
If you have read an audio file into memory from your own computer,
you can type `pb' to play the contents of the buffer.
The data is put into a temp file under
/tmp/.edbrowse, and them mpg123 is invoked.
Finally, you can play an mp3 file, or any plugin-enabled file, from directory mode.
The g (go) command plays the file on the current line.
This is very efficient; no need to read the file into memory or create a temporary file under /tmp.

<P>
In some cases the stream is not indicated by protocol or suffix.
A youtube video, for example, looks like just another html page; yet it can be played by a music player.
use the urlmatch atribute for this.

<P>
urlmatch = .youtube.com/watch?

<P>
Some plugins play files, and some plugins process files.
The outtype attribute determines the type of plugin.
In this example, a pdf file turns into html, where it can be browsed in the usual way.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>plugin {
type = pdf
desc = pdf file
suffix = pdf
content = application/pdf
#  file must be local
down_url
program = pdftohtml -i -noframes %i %o >/dev/null
outtype = H
}
</font></PRE>

<P>
Other plugins could convert rich text, Word docs, Open Office docs, etc.
Set outtype to h if the output is in html, or t if the output is in text.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>plugin {
type = Word doc
desc = Microsoft Word document, not docx
suffix = doc
content = application/msword
down_url
#  without %o, the output is piped directly into the buffer
program = catdoc %i
outtype = T
}
</font></PRE>

<P>
Note, there are pdf to text converters that skip the middle html step,
but I wanted to preserve the functionality of any hyperlinks that might be embedded within pdf,
so I thought it worthwhile going through html, even though it adds another step.

<H3> <A NAME=sampcfg> A Sample Config File </A> </H3>

The best documentation is an example,
so I have provided a sample config file with fake data.
It is well commented.
You can see a copy <A HREF=sample.ebrc>here</A>.
Also available in
<A href=sample_fr.ebrc>French</A>
and
<A href=sample_it.ebrc>Italian</A>.

<hr>
<H2> Chapter 7, Mail Client </H2>

<H3> <A NAME=sm> Send Mail </A> </H3>

Email the contents of your current editing session to someone else
via the `sm' command.
Your email accounts are described in the <A HREF=#cfg>config file</A>.

<P>
Most mail clients can automatically append a signature to outgoing email
messages; edbrowse is no exception.
In fact, you may have a different signature for each of your mail accounts.
Thus, you can use one signature for work email,
and another for personal email.
When sending mail from account N, edbrowse first checks for a file named
.signatureN in your home directory.
For example, when sending from account 2, edbrowse looks for .signature2.
If that file is not found, edbrowse looks for a file named .signature in
your home directory, appending its contents if it is found.
<P>
The recipients, attachments, and subject must appear at the top of your file.
The sm command is picky, so observe the following syntax carefully.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>To: fred.flintstone@bedrock.us
CC: barney.rubble@bedrock.us
account: 1
attach: hollyrock-brochure.pdf
Subject: Hollyrock Vacation
Come visit Hollyrock.
Brochure attached.
Sincerely,
Rock studios incorporated.
</font></PRE>

<P>
The account line is optional.
It tells edbrowse to use the first mail account specified in your .ebrc config file.
If you don't include an account: line,
edbrowse uses the default account, indicated by "default" in your .ebrc file.

<P>
Typing sm5 causes edbrowse to use account number 5.
This overrides the account: line if there is one.
It is often easier to type sm5 than to insert an account:5 line.
Note, sm-5 is the same as sm5, but the .signature file is not included.
Sometimes you want a different ending on your email for a particular situation.

<P>
Use the attach: lines to add attachments to your email.
Each line should specify a file to attach,
and they must appear before the subject line.
If the filename is simply a number,
the corresponding edbrowse session is used instead.
Return to the earlier example,
where we are trying to attach a Hollyrock brochure.
Another way to do this is to switch to session 2 and read in the pdf file.
This is a binary file, but that doesn't matter.
Don't try to edit it, just hold it in session 2.
Then switch back to session 1 and use the line attach:2.

<P>
If you use attach:2, instead of attach:hollyrock-brochure.pdf,
Fred will notice one difference.
The attachment is not prenamed for him.
If he wants to save the attachment,
he'll have to come up with a filename himself.
Other than that, the email looks the same.

<P>
The alt: directive is almost the same as the attach: directive.
If you use alt:, the attachment is not treated as an adjunct file.
Instead, it is an alternate representation of the same email.
The mail client will use the alternate representation if it can.
This is usually used to send multimedia email
with hyperlinks and pictures etc.
The primary email is in plain text,
but the alternate attachment is in html or rich text.
Unless something is amiss, the user sees the alternate presentation,
complete with graphics and hyperlinks.
Like attachments,
the alt: line can refer to a file or an edbrowse session.

<P>
As you may have guessed,
the to: lines establish the recipients.
Please don't specify more than a few dozen recipients.
Some mail servers
set a hard limit of 100 on the number of recipients.
If you exceed this number,
the remaining recipients simply don't get their mail.
Best to limit your "to:" lines to a couple dozen.

<P>
Remember that CC stands for carbon copy.
This tells the recipient, in this case Barney Rubble,
that he is receiving a copy of the email for his convenience;
he need not respond.
Use BCC for blind carbon copy, so that each person does not see all the other email addresses.

<P>
When specifying recipients, you can use aliases instead of full email addresses.
Aliases are checked against your address book,
a text file that is specified in your .ebrc file.
If your address book contains the line
<P>
fred : fred.flintstone@bedrock.us : 226 cobblestone way : 5553827
<P>
then you can simply write "To:fred" at the top of your file.
Only the first two fields in the address book are significant
as far as edbrowse is concerned.
Other fields might hold phone/fax numbers, street address, etc.
That's up to you.
<P>
Note that "Reply to fred" is an alternate syntax for "to: fred".

<P>
Some web pages include sendmail links.
They look just like other hyperlinks, but they send email to the appropriate person.
If you activate a sendmail link,
you will be placed in a new editing session with the "to" and "subject" lines preloaded.
If the url did not specify a subject,
the subject is simply "Hello".
You will probably want to replace this with a better subject line.
Write your mail message and type `sm' to send it on its way.
Then type ^ to return to the web page you were looking at.
Note that the body of your email may also be preloaded with some default text,
so be sure to check before you write and send.

<P>
You can include attachments by placing "attach:" lines at the top of the file,
assuming the recipient can handle these attachments.
This might make sense when the sendmail link is asking for bug reports -
you might attach a program and/or its output.
Yet this is somewhat unusual.
Most sendmail links expect a few sentences of feedback, and nothing more.

<P>
Some web forms are submitted via email, rather than a direct http transmission.
Edbrowse handles this properly.
It shows you the destination email address,
sends the mail through smtp,
and tells you to watch for a reply.
This reply could be an email response, or even a phone call
if you provided your phone number in the form.
But remember, nothing happens immediately.
You are still on the same web page, still looking at the same submit button.
Don't push the button again!
The mail has been sent,
and you'll be hearing from the company in the next few days.

<H3> <A NAME=smc> Send Mail Client </A> </H3>

as described in the previous section,
edbrowse incorporates the features of a mail client.
In addition to the interactive `sm' command,
you can send mail in a batch fashion from the command line.
If fred and barney are in your address book,
and you want to send them mail from the command line, with an attachment,
using your first email account, do this.
<P>
edbrowse -m1 fred ^barney hollyrock-notice +hollyrock-brochure.pdf

<P>
The ^ in front of barney means he is a CC recipient.
Use "?barney" for BCC.

<P>
Files with a leading + are assumed to be attachments.
A leading - indicates an alternate format, like this.

<P>
edbrowse -m1 fred ^barney hollyrock-notice -hollyrock-graphical.html

<H3> <A NAME=retrmail> Retrieving Mail </A> </H3>

If edbrowse is invoked with the -f option, it will fetch mail from all
accounts, except the ones that you have marked nofetch.
Alternatively, you may specify a number following -f, in order to fetch
mail from a single account.
For instance, -f1 will fetch mail from your first mail account,
ignoring all the rest.
When it has finished retrieving mail, the program prints the
total number of messages that it retrieved.
Fetched messages are stored in a directory named unread/, relative to
the directory specified with the maildir setting in your .ebrc file.
You may read them, as described in the next section.

<P>
Remember, you can specify several mail accounts in your .ebrc file.
The first account is indicated by index 1, as in -m1, and so on.
You can make life easier with some aliases in your .bashrc file.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>#  My mail, home account
alias mymail="edbrowse -fm1"
#  My wife's account.
alias wifemail="edbrowse -pfm2"
#  My work account.
alias workmail="edbrowse -fm3"
#  mail is obsolete
alias mail="echo use mymail, wifemail, or workmail"
</font></PRE>

<H3> <A NAME=imr> Interactive Mail Reader </A> </H3>

If edbrowse is run with the -m option, and no other arguments,
it is an interactive mail reader,
allowing you to examine mail from your directory of unread messages.
If you wish to retrieve and read in one step, you can combine the -f
and -m options.

<P>
The first thing it tells you is how many messages you have.
If there are no messages it says "No mail", and exits.
If there are unread messages, it shows each one in turn.
For each message, it displays some header information (such as subject
and sender) and the first page of text, and then presents a prompt.
A '?' prompt means the message is complete -
a '*' prompt means there is more text to read.
You respond by hitting a key.
Keys have the following meaning.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>?	summary of key commands
q	quit the program
space	display more text
n	read the next message
d	delete this message
w	write this message to a file and delete it
u	write this message unformatted to a file and delete it
</font></PRE>

<P>
The last two commands, w and u, require a filename, which you enter.
The reserved filename, "x" or "X", is essentially /dev/null,
whence the mail message is discarded.
You can save the mail message to x (discard) and still save the attachments.
If the file is anything other than x,
and edbrowse cannot write to the specified file, it asks you for a new filename.

<P>
In practice, you might save a message with w, later realizing that you
need something, such as a hyperlink or attachment, which is only available
in the unformatted message.
When you use the w command to write a formatted message to a file, edbrowse
retains an unformatted copy as well.
These copies are placed in the directory $HOME/.Trash/rawmail,
with file names consisting of 5 digit numbers.
When you save a formatted message, you'll notice some text like
&quot;Unformatted 12345&quot; at the end of the file.
This tells you where to find the original, unformatted message:
$HOME/.Trash/rawmail/12345.
As mentioned previously, it's a good idea to run a weekly cron job to clean
out the trash bin; if that cron job removes subdirectories, it will insure
that raw mail does not accumulate indefinitely.

<H3> <A NAME=mailfmt> Formatted Mail </A> </H3>

When mail is retrieved, it is saved in the directory of unread
messages without any formatting applied.
In other words, it is a faithful copy of the message as it existed on
the server.
When you read it by invoking edbrowse with the -m option,
edbrowse displays it after applying various formatting rules.
You can save the message in either its raw or formatted state.
Selecting `w' at the interactive mail prompt writes the formatted version
to disk, while selecting `u' saves the unformatted version.

<P>
When an html mail message is rendered, javascript is disabled.
If you want to interact with this email message,
you must save it unformatted to a file,
finish your email session, edit that file,
and type b to browse.
Now the html is active, as though you were looking at a web page on somebody's site.

<H3> <A NAME=filter> Mail Filtering </A> </H3>

The config file supports a modest level of mail filtering.
You can redirect incoming mail
based upon the sender, the receiver, or the subject.
These parameters are established in your config file.
A mail filtering rule has the form:
<P>
matchString &gt; destinationFile

<P>
Actually the &gt; is a bit misleading.
If the file exists, the email is appended to the end; the file is not truncated.
So perhaps we should use &gt;&gt;,
but I didn't want to bother with the extra greater, over and over again.

<P>
The destination file is interpreted relative to the mail directory,
which is set in your config file.
Of course you can override with an absolute path if you wish.

<P>
A mail filtering rule always occurs in the context of a filter block.
For instance, if you wish to redirect mail from certain people, do this.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>fromfilter {
fred flintstone &gt; fredmail
fred.flintstone@bedrock.us &gt; fredmail
jerk@hotmail.com &gt; x
word@m-w.com > -wod
}
</font></PRE>

<P>
You can specify the sender's name or his email address.
It's not a bad idea to do both,
in case he sends mail from some other account.

<P>
Notice that I didn't capitalize Fred Flintstone.
Matches are case insensitive.

<P>
The file name "x" is special; it discards the mail entirely.
You can use this to throw away mail from people
who are constantly harassing you or sending spam.

<P>
The last entry sends mail to -wod.
The leading - is special;
it means the mail should be saved to wod unformatted.
This happens to be the word of the day from Merriam Webster.
You can save it unformatted, then browse it,
and click on {audio} to hear the word pronounced.
If an email contains hyperlinks,
you may want to save it unformatted
so you can browse it later.

<P>
You can also filter mail based on the to: field.
This is useful if you have several mail accounts,
or mail aliases that are forwarded to your primary account.
Here is a sample block.
<PRE><font size=3 face=Arial,Helvetica,sans-serif>tofilter {
support@my-side-business.com &gt; support
sales@my-side-business.com &gt; sales
@my-side-business.com &gt; business
me@my-regular-dayjob.com &gt; work
}
</font></PRE>

<P>
The third entry is a catchall address,
saving any mail that is sent to that domain.
Since rules are applied in order,
support requests are stored in a file called "support",
sales are stored in a file called "sales",
and all other emails sent to your business are stored in "business".

<P>
You can use catchall addresses in the fromfilter block as well.
Anything from this domain goes here.

<P>
You can filter based on subject, using the subjfilter{...} block.
This can close the door on the virus de jure.
If a virus uses a subject line of "Come Kiss Me",
you can redirect "come kiss me" to x, and it's gone.

<P>
You can also use this feature to block warnings from other ISPs,
complaining that you sent them emails with virus attachments.
You didn't, of course, because you run linux, and a nonstandard mail client to boot.
Your reply address was forged, so the virus warning was sent back to you,
but you really had nothing to do with it.
this is called backscatter.
Lines like this one can throw these spurious warnings away.

<P>
subjfilter {
<br>
Come Kiss Me > x
<br>
Net Integrator Virus Alert > x
<br>
}

<P>
If the subject equals the match string (case insensitive),
or the subject begins or ends with the match string, and is not more than twice as long as the match string,
then the email is redirected.

<P>
Finally, the reply address is checked against your address book.
If there is a match, the mail is saved in a file whose name is the email alias.
Consider a line in your address book that looks like fred:Fred.Flintstone@SomeDomain.com.
When you receive email from this particular address, it is saved to the file fred.
Thus you don't have to enter and maintain redundant entries in the filter.
There is no need to include Fred.Flintstone@SomeDomain.com &gt; fred.
It's taken care of by your address book.

<P>
If you want to save mail from Fred unformatted, place a minus sign,
i.e. -fred, in your address book.
This is the same convention as the from filter.
If you don't want mail from Fred to be redirected,
but you still want to use the alias fred when sending mail,
place an exclamation mark at the start, i.e. !fred.

<P>
If an email is redirected to a file, and it includes attachments,
edbrowse will ask you what to do with those attachments,
as though you had used the w command to save the mail yourself.
If your friend has send you a program (attached) that he wants you to look at, just hit return
to save it to the default filename.
If your friend's mail has some kind of logo, or background image, that you don't care about,
type x and it will go away.
If the image has a recognizable suffix, such as gif, I discard it automatically.
If you really want these images, you'll have to save the email unformatted and browse it later.
When browsing an email inside the editor,
edbrowse offers you all the attachments, be they images or not.
You can discard a single attachment by entering x,
or all the image attachments by entering capital X.

<P>
Use the -p option to pass over the filters, as in `e -pm1'.
I set this when looking at other people's mail, such as my wife's account.
I don't want her mail sent somewhere else because it matches one of my filter rules.

<H3> <A NAME=reply> Mail Reply </A> </H3>

The `re' command prepares a formatted email for reply.
The "Reply to" line (which must exist) is moved to the top.
This contains the email address that you will reply to,
and it is created when you format (i.e. browse) your email message.
If this line is not present, the reply command will fail.

<P>
The "Subject:" line must also be present.
This too is created when the email is formatted.
After the re command is issued, the subject may move down the page,
to make room for other email headers as follows.

<P>
If this email has just been browsed,
and the unformatted data still exists within the current edbrowse session,
or if this same data is available in the database file maildir/.reply,
then re inserts the message id of the original email.
This should be part of the reply.
The resulting lines might look like this.

<P>
Reply to somebody@foo.bar.com
<br>
references: <4387A55E6AF43C4F9830C74EFECE9132022D0638@foo-bar.net>
<br>
Subject: What's in a name?

<P>
The reference line is not a line you should ever type in, edit, or delete.
Just leave it be.
If you participate in a discussion list, this line is important.
It tells the server that your reply is indeed a reply
and that it should be linked to the referenced message.
Using this information, the server maintains discussion threads.
If you delete this line before sending your response,
you will create a new thread, and that will only confuse and annoy
the other participants.
So - if you are going to reply to a message on a discussion list,
make sure the re command inserts the References: line, and then leave it alone.
Edit the body of the email, add your comments, and send.

<P>
Sometimes the references line will have two IDs separated by white space.
The first is the beginning of the thread, the message that started this topic,
and the second is the comment that you are replying to directly.
Again, this helps list servers organize the emails into threads.

<P>
The command `rea' means reply to all,
and this also uses the original email data.
All the recipients will appear at the top of your file.
Some will be indicated by cc, if they were carbon copied.
You can delete any of these recipients before sending your response.
Of course you probably don't want to delete the first line,
as that is the reply to address.

<P>
If the email was unformatted,
and you have typed b to browse it,
the re command takes the file out of browse mode and turns it into a plain text file.
This supports text editing, to write your reply in the body of the message.
If you want to start over from scratch,
you can't just unbrowse, because it is not in browse mode.
You must re-edit the saved mail message,
browse, and reply.
Like everything else in edbrowse, you'll get use to it once you play with it.

<H3> <A NAME=imap> Imap Client </A> </H3>

A pop3 client, as described above, fetches mail down to your computer,
whereupon you are responsible for it.
You must archive your emails, if you wish, and back them up, etc.
However, the imap protocol allows you to keep your emails on the server indefinitely,
in the cloud so to speak.
You can access your email, perhaps 20 years worth of email, perhaps 100,000 messages,
from any computer or any tablet or any smart phone.
You can download emails locally if you wish, but you don't have to.
This is more of a server side approach.
The earlier configuration entry for gmail,
when adjusted for imap, looks like this.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>mail {
  imap
  inserver = imap.gmail.com
  outserver = smtp.gmail.com
  secure
  login = somebody@gmail.com
  password = secret
  reply = somebody@gmail.com
  from = Full Name
}
</font></PRE>

<P>
If this is the third mail entry in your config file, then you access this account by `edbrowse -f3'.
This does not simply fetch all the emails down to your local computer,
as is the case with a pop3 account.
Rather, edbrowse provides access to all the emails on the imap server in an interactive fashion.
Here is a sample screenshot.

<PRE><font size=3 face=Arial,Helvetica,sans-serif> 1 INBOX, 0 messages
 2 [Gmail]/All Mail, 7 messages
 3 [Gmail]/Drafts, 0 messages
 4 [Gmail]/Important, 0 messages
 5 [Gmail]/Sent Mail, 0 messages
 6 [Gmail]/Spam, 7 messages
 7 [Gmail]/Starred, 0 messages
 8 [Gmail]/Trash, 16 messages
Select a folder by number or by substring.
q to quit. l to change fetch limit.
</font></PRE>

<P>
Type 6, or spam, or just spa, and edbrowse takes you through the 7 messages in the Spam folder.
It prints the sender, subject, date, and size of each email,
also known as its envelope,
and asks you what to do, similar to the pop3 client interface.
Type q to quit, n for the next message, d to delete,
or m to move this message to another folder.
Again, you can specify the destination folder by number or by name.
Type space to read the body of the email, and keep typing space,
like more, to read as much of the email as you wish.
Type w to write the email formatted, or W to write and delete.
Type u or U to save the email unformatted.
Type a to save the attachments.
Type l to change the fetch limit, i.e. the number of emails that are presented at one time.
Use a negative number to fetch the earliest emails, rather than the most recent.
Type / to search for emails by subject, by sender, or by the text in the body of the email.
Finally type h for the help message, which looks like this.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>
h   print this help message
q   quit this program
s   stop reading from this folder
n   continue to next message
d   delete this email
m   move this email to another folder
v   view all
b   batch move or delete
f   from move or delete
space   read and manage this email
/   search for words in subject, from, or body
l   set imap fetch limit
</font></PRE>

<P>
On some servers, such as gmail, you can't delete an email from the "All Mail" folder.
Instead you must move it to Trash and then delete it from there.

<P>
The search is case insensitive, and often looks for words, rather than simple substrings.
Thus foo matches Foo, but does not match foobar.
The implementation will depend on your imap server.
The default is to search through subjects.
Type `f Smith' to search for mail from Smith,
or `b neutron star' to find all emails that talk about a neutron star.
If there are thousands of matches, only the last 100 are shown.
You can change this limit with the l command.

<P>
If there are 300 emails in your spam folder, there is an easy way to delete them all.
Type v to view them all, just to make sure a valid email didn't wind up here.
You don't want to delete anything good by mistake.
Then type b for batch mode, then d to delete.
Poof, they're gone.
In the same way, you can batch move all the messages to another folder.
However, move is more useful with the from clause.
If the current message is from Fred Flintstone, type f, and edbrowse will print "from Fred Flintstone".
Then type m cartoon, and all the messages from Fred Flintstone will move to the cartoon folder.
Warning, older imap servers, prior to 2013, implement move as a copy followed by delete.
The delete does not take place until you reach the end of the folder.
Thus, if you move a file on such a server, then type q to quit, or otherwise exit the program before reaching the end of your folder, you will log back in and find two copies of your message.
You can avoid this by typing s, to stop reading the current folder; this will delete any messages marked for deletion.
Newer servers implement move as a true move, whence this situation will never arise.

<P>
The create and delete commands will create new folders or delete existing folders.
Type `create foo' to create a new folder foo.
You can move messages into it right away.
Warning - if you delete foo, all the messages in foo could disappear.
This will depend on the imap server.
You can rename a folder via `rename foo bar'.
This command assumes there is no whitespace in a folder's name.

<hr>
<H2> Chapter 8, Database Access </H2>

<H3> <A NAME=sqlb> Building edbrowse with Database Access </A> </H3>

If you simply type make, you get edbrowse with no database functionality.
A separate option supports database access through odbc.
To link edbrowse with odbc,
run `make BUILD_EDBR_ODBC=on'
in the src directory,
or in the build directory type
`cmake -DBUILD_EDBR_ODBC:BOOL=ON ..'.
This assumes you have the unixODBC and unixODBC-devel packages installed on your machine.
A separate target, edbrowseinf, provides a direct link to an
<A HREF=http://www.informix.com>Informix database</A>.
This works, but is not generally supported.
Other database specific edbrowse connectors could be built.
You are basically implementing the interface described in dbapi.h,
using the C database development toolkit provided by the vendor.
Since odbc connects to everything, it will probably meet your needs.

<H3> <A NAME=rtb> Reading Tables </A> </H3>

When a file name is of a certain format, with http:// in front,
it is deemed to be a url.
Edbrowse does not look on your computer for the file; it goes out to the internet.
Similarly, when the file name has a certain format,
it is assumed to be a table or view in the database.
If you have a table called customers, follow it up with a right bracket.

<P>
e customers]

<P>
This allows you to bring in the entire table,
or portions thereof, one row per line, with fields delimited by pipes.
If the result looks like a bunch of numbers and pipes,
and you have forgotten the structure of the table,
use the shc (show columns) command.
The output might look like this.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>Table customers, 536281 rows
1 *custnum int
2 firstname string
3 lastname string
4 birthdate date
5 sex char
6 email string
7 picture blob
</font></PRE>

<P>
The first column is a unique number that designates this particular customer.
After all, two customers could have the same first and last name,
and even the same birthdate.
Serial numbers are always a good idea,
and that usually becomes the primary key.
This is indicated by a star just before the column name.
When edbrowse changes or deletes a record, the primary key is used.
I assume, at all times, that the key determines a unique record in the database,
and that each record appears at most once in an editing session.
You could read customer 37 in twice, thus having two copies in your buffer, but don't do it!

<P>
Note that edbrowse can support a primary key with two or three columns, such as a serial number and a modifier.
More than three key columns are not supported.
If the primary key comprises more than three columns, or if the table has no primary key,
you will not be able to update or delete.
Rows in the table are readonly.

<P>
The table syntax is more than just an identifier and a right bracket.
You can follow the right bracket with a where clause.
This is important if you don't want the entire table,
especially if there are millions of rows.
Here are some table commands and their meanings.

<P>
customers]
<br>
Set the buffer up for the customers table, but don't fetch any rows.

<P>
customers]*
<br>
Fetch all the rows in the table.

<P>
customers]37
<br>
Fetch the customer whose serial number is 37.
The primary key is assumed; your table has to have a primary key
if you are going to use this syntax.

<P>
customers]1=37
<br>
Fetch the row whose first column is 37.

<P>
customers]37-59
<br>
Fetch the customers with serial numbers between 37 and 59 inclusive.

<P>
customers]3=Smith
<br>
Fetch the customers whose last name is Smith.

<P>
customers]lastname=Smith
<br>
Same as above.

<P>
customers]last=Smith
<br>
Same as above.
If the string uniquely gloms onto a column name, we're all set.

<P>
customers]last=Barn*
<br>
Fetch the customers whose last names begin with Barn.

<P>
customers]birth=01/01/1960-12/31/1960
<br>
Fetch the customers who were born in 1960.

<P>
It is usually best to edit with a blank template, i.e. without a where clause.
Then you can read in whatever rows you like.
Type an r before any of the strings shown above to read rows into your buffer.
Note, you cannot read data from different tables into the same buffer,
but you can switch to another editing session to look at another table
without losing the rows you are working on.

<P>
When reading rows into a growing buffer, you can usually omit the table, since it has to be customers] every time.
For instance, you can bring in customer #738 by typing `r customers]738' or `r 738'.

<P>
If you want a clean slate, type `rf' to refresh the buffer.
This brings you back to a template for the table with no rows.
WARNING - do not clear your buffer by deleting all the rows,
as that will delete the corresponding entries in the database.
This feature works just like directory mode -
your edits are translated into actions in the real world, so be careful!
Referential integrity might save you from this accidental delete disaster,
if you routinely use this sql feature to link tables together,
which is a good idea at many levels.
But don't rely on it!

<P>
Now, how about the seventh column in our example, the one called "picture"?
This is the customer's picture, a jpg image that is in binary,
and cannot be easily folded into an editing session.
Instead, it is stored in another buffer,
e.g. buffer 9, and this is indicated by &lt;9&gt;.
You can switch to session 9 and save the file, or throw it away.

<P>
2139|Fred|Flintstone|08/21/1969|M|foo@bar.bar.com|&lt;9&gt;

<P>
Binary columns are not fetched by default.
You usually don't want them anyways.
To fetch binary columns, use the fbc command.
It is not possible to fetch more than one binary column at a time,
so make sure your select only grabs one such column.

<H3> <A NAME=dsource> Data source </A> </H3>

To do anything with the database, your config file must specify
the name of the data source, the login, and the password.
Data source must match one of the entries in your .odbc.ini file.
Login and password can sometimes be omitted, if they are inferred from your identity on the computer,
or they are set in the data source in your .odbc.ini file.
Here is how the line might look
if you are tapping into the retail database, where the customers table resides.

<P>
datasource = retail,mylogin,mypassword

<P>
This can be changed at run time by the ds= command.
Make sure you do not refer to any old rows in buffer after you have switched to a new data source.

<P>
In some cases you can access other databases without changing the data source.
For instance, you can read the parts table in the inventory database by calling up inventory:parts].
This is standard sql syntax for looking at tables in another database;
edbrowse just passes it through.

<H3> <A NAME=insupd> Insert, Update, Delete </A> </H3>

Now that we have run a few selects, let's modify some data.
These operations are known as insert, update, and delete in the database world.

<P>
Adding database rows is substantially different from adding text.
Since a row may contain a dozen fields, and you may not remember what goes where,
edbrowse prompts you for each field in turn.
It also checks the integrity of each field as you go,
e.g. a date has to look like mm/dd/yyyy etc.
If a row cannot be added because of a database error,
edbrowse prints the error
and data entry continues,
giving you a chance to reenter the row.
Data entry stops when you enter a period all by itself,
no matter what field you are on.
The rows that were entered successfully will be present in your buffer,
and the current line is the last entered row.
Blobs cannot be entered at this time.

<P>
A row appears as you typed it; and this may differ from the actual values in the database.
for instance, you might put a null into a field that is "default 3".
Within the database, the value is 3, but there is nothing in that field in your buffer.
Another field might truncate a floating point number, according to the precision of that column.
Another field might be type serial, and turn 0 into the next serial number.
And then there are triggers.
There are many ways data can be modified as it enters the database.
It would be better to refresh each row as it is inserted,
so you could see exactly what is there,
but this is not implemented yet.
remember, you can always type `rf' to get an empty buffer, and then reread the rows you just inserted.

<P>
If the first column of the primary key is an integer, and you enter a 0,
edbrowse selects the next number in sequence.
Some databases do this internally, some don't,
thus it is done at the front end.
There is a possible race condition here, if you and somebody else glom onto the same serial number,
but it's not likely,
and it will create a "duplicate key" error in any case.

<P>
Use the substitute command to update a row.
Make sure you don't accidentally introduce an additional pipe, or remove a pipe.
Key columns cannot be modified.
If you are updating many rows with one command,
through a range or through g//s,
and an error occurs while updating the database,
substitution stops in its tracks.
The editing session will reflect the database,
with some rows changed and others untouched.
There are many reasons for these update errors, including datatype mismatch
(e.g. pushing an integer into a date field), and check constraints
(e.g. putting J in for sex instead of M or F).
If you have any say in the database design,
apply check constraints wherever they make sense.
They will protect you from erroneous substitutions that would produce inconsistent data.

<P>
Delete works as you would expect; delete a row,
and the corresponding entry disappears.
There is no undo command.
It couldn't be done in any case, since you may have selected only part of the row (see below),
and I wouldn't have all the data to put the row back.
As mentioned before, referential integrity should be employed wherever it makes sense.
As a last check, I only let you delete 100 rows at a time.
Be careful, and run regular backups.

<H3> <A NAME=td> Table Descriptors </A> </H3>

Suppose a table contains 100 fields.
Displaying all those fields is awkward, to say the least.
Sometimes you are interested in a group of 6 fields,
and sometimes you are interested in another group of 8.
You can set up virtual tables, similar to views, in your config file.
The short name is the alias, and you can call up the table using this alias.
It will contain only the columns you specify.
Here are two descriptors for the aforementioned customers table.

<PRE><font size=3 face=Arial,Helvetica,sans-serif>table {
    tname = customers
#  cnm is my cryptic shorthand for customer name
#  I want to be cryptic here, cause I'm going to be typing this a lot.
    tshort = cnm
    cols = custnum,firstname,lastname
#  Specify the primary key, in this case, the first column selected.
    keycol = 1
}

table {
    tname = customers
#  All I care about here is customer and birthdate.
    tshort = cbd
    cols = birthdate,custnum
    keycol = 2
}
</font></PRE>

<P>
When inserting a row through one of these descriptors,
you are only specifying a subset of the columns in the table.
The other columns will be null, or they will take on their default values
as specified by the schema.
If you receive a Not-Null error, it could be due to one of the other columns,
which requires an entered value.
It is usually safer to insert a row using the complete table.

<H3> <A NAME=gosql> Go SQL </A> </H3>

If you know the trick, you can feed sql statements directly to the database,
similar to the isql program that ships with odbc.
Within a text buffer (not a table buffer),
place a right bracket at the beginning of a line, then write your sql statement.
Your statement can run across many lines, but it must have a semicolon at the end of the last line,
or a leading right bracket at the beginning of the following line.
Type g by itself to go, thus sending the statement to the database.
This is similar to g on a web page, which goes to a hyperlink.
Edbrowse reports any errors,
or the number of rows modified.
In a select statement,
the fetched rows will appear just below the statement,
with pipes delimiting the columns.
All this happens in the current buffer.
Delete what you don't need (it's just text),
or save the data to a file and import it into a spreadsheet.
For your convenience, fetched rows will be delimited by the labels 'a and 'b.
Thus you can save the data with a 'a,'bw command.

<P>
Canned queries can be saved in a file for future use.
Call them up, modify parameters, and go again, like a qbe screen.

<P>
] select * from customers, address
<br>
where custnum = addrnum and addrtype = "HOME"
<br>
and custnum between 500 and 600;

<HR><P class=cen>
<A href=#top>Return to top</A>

</BODY></html>
